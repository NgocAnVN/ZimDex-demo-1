/* ======================================================================
   ZimDex Settings — style.css
   - Glass desktop + dock + window
   - Sidebar + main grid
   - Centered dock gear with white indicator (like screenshot 2)
   ====================================================================== */

/* Variables */
:root{
  --wp: url("wallpaper%201.jpg"), url("wallpaper%201.png"); /* default wallpaper try */
  --bg: #0e1116;

  --glass: rgba(32 38 42 / .38);
  --glass-strong: rgba(32 38 42 / .56);
  --glass-subtle: rgba(32 38 42 / .25);

  --stroke: rgba(255 255 255 / .14);
  --stroke-soft: rgba(255 255 255 / .10);

  --fg: #e9eef3;
  --fg-dim: #c9d2d9;

  --accent: #69d0ff;

  --radius: 18px;
  --radius-card: 12px;
  --blur: 18px;

  --shadow: 0 30px 80px rgba(0,0,0,.45), 0 2px 8px rgba(0,0,0,.25);

  --titlebar-h: 40px;
  --dock-h: 64px;
}

/* Reset / base */
*{ box-sizing: border-box; }
html, body{ height: 100%; }
body{
  margin: 0;
  background: var(--bg);
  color: var(--fg);
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  overflow: hidden;
  user-select: none;
}

/* Screen reader only */
.sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }

/* Wallpaper layer */
.desktop{
  position: fixed;
  inset: 0;
  background-image: var(--wp);
  background-size: cover;
  background-position: center;
  transition: background-image .25s ease;
}
.desktop::after{
  content:""; position:absolute; inset:0;
  background:
    radial-gradient(1000px 50% at 50% 120%, rgba(0,0,0,.35), transparent 70%),
    linear-gradient(to top, rgba(0,0,0,.35), rgba(0,0,0,0) 30%);
  pointer-events:none;
}

/* Top clock */
.topbar{
  position:fixed; left:16px; right:16px; top:10px; height:28px;
  display:flex; align-items:center; justify-content:flex-start;
  color:var(--fg); font-weight:700; letter-spacing:.2px; font-size:14px;
  text-shadow:0 1px 2px rgba(0,0,0,.45);
  z-index: 40;
}

/* Window */
.window{
  position:absolute; width:1020px; height:600px; left:50%; top:100px; transform: translateX(-50%);
  display:grid; grid-template-rows: var(--titlebar-h) 1fr; overflow:hidden;
  border-radius:var(--radius); border:1px solid var(--stroke);
  background:var(--glass); backdrop-filter: blur(calc(var(--blur) + 2px)) saturate(150%);
  -webkit-backdrop-filter: blur(calc(var(--blur) + 2px)) saturate(150%);
  box-shadow:var(--shadow); z-index: 45;
}
.titlebar{
  display:flex; align-items:center; justify-content:space-between; padding: 0 10px 0 16px;
  background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,0));
  border-bottom:1px solid rgba(255,255,255,.08);
  height: var(--titlebar-h);
  cursor:grab;
}
.title{ font-weight:800; letter-spacing:.2px; color:var(--fg); font-size:15px; opacity:.95 }
.win-controls{ display:flex; gap:6px; }
.ctrl{ width:34px; height:28px; display:grid; place-items:center; border-radius:8px; color:var(--fg-dim); cursor:pointer; transition: background .15s ease, color .15s ease, transform .1s ease;}
.ctrl:hover{ background:rgba(255,255,255,.08); color:var(--fg); }
.ctrl:active{ transform: translateY(1px); }
.ctrl.close:hover{ background:rgba(255,80,80,.28); }
.ico{ width:16px; height:16px; }

/* Content split */
.content{
  display:grid; grid-template-columns: 270px 1fr; gap:18px; padding:16px;
}

/* Sidebar */
.sidebar{
  background: rgba(0,0,0,.18); border:1px solid var(--stroke-soft); border-radius:14px; padding:12px; display:flex; flex-direction:column; gap:10px; min-height:0; overflow:hidden;
}
.search{
  height:40px; border-radius:12px; padding:0 12px; display:flex; align-items:center; gap:8px;
  background: rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12);
  color:var(--fg-dim); font-weight:700;
}
.nav{ display:flex; flex-direction:column; gap:6px; margin-top:6px; overflow:auto; padding-right:4px; min-height:0; }
.nav-item{
  height:38px; display:flex; align-items:center; gap:12px; padding:0 12px; border-radius:10px; cursor:pointer; color:var(--fg); opacity:.95;
  border:1px solid transparent; transition: background .15s ease, border .15s, opacity .15s, transform .1s ease;
  white-space:nowrap;
}
.nav-item:hover{ background: rgba(255,255,255,.07); }
.nav-item:active{ transform: translateY(1px); }
.nav-item.active{
  background: #fff; color:#0f141a; border:1px solid rgba(0,0,0,.12);
}
.dot{ width:10px; height:10px; border-radius:50%; }
.d-blue{ background:#3aa4ff } .d-orange{ background:#ffa940 } .d-red{ background:#ff526c }
.d-green{ background:#38d466 } .d-cyan{ background:#28d5e6 } .d-purple{ background:#9f7bff }
.d-gray{ background:#a7b1ba } .d-pink{ background:#f28ad1 } .d-lime{ background:#a3e635 }

/* Main panel grid like the sample */
.panel{ display:grid; grid-template-columns: 360px 1fr; grid-auto-rows: min-content; gap:16px; min-height:0; overflow:auto; padding-right:4px; }
.card{
  background: rgba(0,0,0,.18); border:1px solid rgba(255,255,255,.12);
  border-radius: var(--radius-card); padding:12px; min-height:72px;
}
.card.tight{ padding:10px; }
.kv .k{ color:var(--fg-dim); font-weight:700; font-size:13px; }
.kv .v{ font-weight:800; font-size:18px; margin-top:4px; letter-spacing:.2px; }

/* Grid areas to match screenshot */
.g-name{ grid-column:1; grid-row:1; height:90px; }
.g-hero{ grid-column:2; grid-row:1 / span 2; height:196px; overflow:hidden; padding:0; position:relative; }
.g-more{ grid-column:1; grid-row:2; height:90px; }
.g-spec{ grid-column:1 / span 2; grid-row:3; }
.g-about{ grid-column:1 / span 2; grid-row:4; }

.hero{
  position:absolute; inset:0; background-image: var(--wp);
  background-size: cover; background-position: center;
}
.hero:after{ content:""; position:absolute; inset:0; background: linear-gradient(0deg, rgba(0,0,0,.45), rgba(0,0,0,.05)); }
.hero h1{
  position:absolute; right:18px; bottom:14px; margin:0; font-size:52px; line-height:1; font-weight:800;
  text-shadow:0 10px 30px rgba(0,0,0,.55);
}
.hero h1 span{ color:#a9dcff; }

.spec-grid{ display:grid; grid-template-columns: repeat(3, 1fr); gap:14px; }
.spec{
  background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12);
  border-radius: 10px; padding:10px 12px; min-height:64px;
}
.spec .label{ display:flex; align-items:center; gap:8px; color:var(--fg-dim); font-weight:700; font-size:13px; }
.spec .val{ font-weight:800; margin-top:2px; }
.ico.small{ width:16px; height:16px; opacity:.9; }

.about-row{ display:flex; align-items:center; justify-content:space-between; }
.about-row .left{ font-weight:700; color:var(--fg-dim); }
.about-row .right{ font-weight:800; }

/* Hidden helper */
.hidden{ display:none !important; }

/* Dock (giống ảnh 2) */
.dock{
  position:fixed; left:18px; right:18px; bottom:14px; height:var(--dock-h);
  display:flex; align-items:center; justify-content:space-between;
  padding:10px 14px; border-radius:16px;
  background:var(--glass); border:1px solid var(--stroke);
  backdrop-filter: blur(var(--blur)) saturate(140%); -webkit-backdrop-filter: blur(var(--blur)) saturate(140%);
  box-shadow:var(--shadow); z-index: 50; overflow: hidden;
}
.dock .left,.dock .right{ display:flex; align-items:center; gap:12px; position:relative; z-index:2; }
.logo{
  width:40px; height:40px; display:grid; place-items:center; border-radius:10px;
  background:linear-gradient(180deg, rgba(255,255,255,.2), rgba(255,255,255,.05));
  border:1px solid rgba(255,255,255,.14);
  box-shadow: 0 6px 16px rgba(0,0,0,.35);
}
#dockLogoImg, #dockSettingsImg{ display:none; width:26px; height:26px; object-fit:contain; }
#dockLogoFallback, #dockSettingsFallback{ display:block; width:26px; height:26px; }

/* Bánh răng đứng chính giữa dock */
.center-abs{
  position:absolute; left:50%; top:0; transform: translateX(-50%);
  height:100%; display:flex; align-items:center; justify-content:center;
  pointer-events:none; z-index:1;
}
.center-btn{
  position:relative; width:52px; height:52px; border-radius:50%;
  display:grid; place-items:center; cursor:pointer; pointer-events:auto;
  background:var(--glass-strong); border:1px solid var(--stroke); box-shadow:var(--shadow);
  transition: transform .15s ease;
}
.center-btn:hover{ transform: translateY(-2px); }
.center-btn:active{ transform: translateY(0) scale(.98); }
.center-btn.ping::after{
  content:""; position:absolute; inset:0; border-radius:50%; border:2px solid rgba(255,255,255,.6);
  animation: ping .7s ease-out forwards;
}
@keyframes ping{ from{opacity:.9; transform:scale(1)} to{opacity:0; transform:scale(1.5)} }

.center-indicator{
  position:absolute; bottom:6px; left:50%; transform: translateX(-50%);
  width:26px; height:4px; border-radius:999px; background:#fff;
  box-shadow: 0 2px 10px rgba(0,0,0,.45);
}

/* Icon nhỏ bên phải */
.qt{
  height:26px; min-width:26px; padding:0;
  border:none; background:transparent; display:grid; place-items:center;
  border-radius:50%; transition: transform .12s ease, background .12s ease;
}
.qt:hover{ background: rgba(255,255,255,.08); transform: translateY(-1px); }
.qt:active{ transform: translateY(0); }
.qt svg{ width:18px; height:18px; opacity:.95; filter: drop-shadow(0 1px 1px rgba(0,0,0,.35)); }

/* Buttons */
.btn{ padding:8px 12px; border-radius:10px; border:1px solid var(--stroke); background:rgba(0,0,0,.22); color:var(--fg); font-weight:700; cursor:pointer; }
input[type=file]{ display:none; }

/* Responsive tweaks */
@media (max-width: 1100px){
  .window{ width: 92vw; height: 70vh; }
  .panel{ grid-template-columns: 320px 1fr; }
}
@media (max-width: 900px){
  .content{ grid-template-columns: 1fr; }
  .panel{ grid-template-columns: 1fr; }
  .g-hero{ grid-column: 1; grid-row:auto; height:180px; }
}

/* Bánh răng ở giữa: không nền, không viền, không bóng (như ảnh 2) */
.center-abs{
  position:absolute; left:50%; top:0; transform: translateX(-50%);
  height:100%; display:flex; align-items:center; justify-content:center;
  pointer-events:none; z-index:1;
}
.center-btn{
  pointer-events:auto;
  width:36px; height:36px;                /* gọn theo ảnh 2 */
  border-radius:50%;
  background: transparent !important;     /* bỏ vòng tròn sau */
  border: 0 !important;                   /* bỏ viền */
  box-shadow: none !important;            /* bỏ đổ bóng */
  display:grid; place-items:center;
  transition: transform .12s ease;
}
.center-btn:hover{ transform: translateY(-1px); }
.center-btn:active{ transform: translateY(0); }

/* Giữ gạch trắng nhỏ ở dưới (indicator) */
.center-indicator{
  position:absolute; bottom:6px; left:50%; transform: translateX(-50%);
  width:26px; height:4px; border-radius:999px; background:#fff;
  box-shadow: 0 2px 10px rgba(0,0,0,.45);
}

/* Ping khi minimize: vẫn giữ (nếu muốn tắt hẳn hiệu ứng sóng thì comment block dưới) */
.center-btn.ping::after{
  content:""; position:absolute; inset:0; border-radius:50%;
  border:2px solid rgba(255,255,255,.6); animation: ping .7s ease-out forwards;
}
@keyframes ping{ from{opacity:.9; transform:scale(1)} to{opacity:0; transform:scale(1.5)} }

/* Icon nhỏ bên phải: không ô nền sau */
.qt{
  height:26px; min-width:26px; padding:0;
  border: none !important;
  background: transparent !important;   /* bỏ hình vuông sau icon */
  display:inline-grid; place-items:center;
  border-radius:50%;
  transition: transform .12s ease;      /* chỉ hiệu ứng nhấc nhẹ */
}
.qt:hover{ transform: translateY(-1px); }
.qt:active{ transform: translateY(0); }
.qt svg{ width:18px; height:18px; opacity:.95; filter: drop-shadow(0 1px 1px rgba(0,0,0,.35)); }
/* Icon ảnh của dock (logo + settings): luôn là ảnh trần */
#dockLogoImg, #dockSettingsImg{
  display:none; width:26px; height:26px; object-fit:contain;
  background: transparent !important; border:0 !important; box-shadow:none !important;
}
#dockLogoFallback, #dockSettingsFallback{ display:block; width:26px; height:26px; }

/* Bánh răng giữa dock: to hơn, không nền, không viền */
.center-abs{
  position:absolute; left:50%; top:0; transform: translateX(-50%);
  height:100%; display:flex; align-items:center; justify-content:center;
  pointer-events:none; z-index:1;
}
.center-btn{
  pointer-events:auto;
  width: 48px;                      /* to hơn */
  height: 48px;                     /* to hơn */
  border-radius:50%;
  background: transparent !important;
  border: 0 !important;
  box-shadow: none !important;
  display:grid; place-items:center;
  transition: transform .12s ease;
}
.center-btn:hover{ transform: translateY(-1px); }
.center-btn:active{ transform: translateY(0); }

/* Kích thước icon bánh răng (ảnh hoặc fallback) */
#dockSettingsImg,
#dockSettingsFallback{
  width: 30px;                      /* tăng kích thước icon */
  height: 30px;
}

/* Thanh trắng trạng thái dưới icon: ACTIVE = dài & sáng, INACTIVE = ngắn & mờ */
.center-indicator{
  position:absolute; bottom:6px; left:50%; transform: translateX(-50%);
  width: 32px;                      /* khi ACTIVE */
  height: 4px;
  border-radius: 999px;
  background: #ffffff;
  opacity: 1;                       /* sáng khi mở app */
  box-shadow: 0 2px 10px rgba(0,0,0,.45);
  transition: width .18s ease, opacity .18s ease, filter .18s ease, transform .18s ease;
}
.center-indicator.inactive{
  width: 18px;                      /* khi ẩn app: ngắn hơn */
  opacity: .35;                     /* mờ đi */
  filter: blur(.2px);
}

/* Icon nhỏ bên phải: không nền vuông sau */
.qt{
  height:26px; min-width:26px; padding:0;
  border: none !important;
  background: transparent !important;
  display:inline-grid; place-items:center;
  border-radius:50%;
  transition: transform .12s ease;
}
.qt:hover{ transform: translateY(-1px); }
.qt:active{ transform: translateY(0); }
.qt svg{ width:18px; height:18px; opacity:.95; filter: drop-shadow(0 1px 1px rgba(0,0,0,.35)); }

/* Góc phải dưới: icon trắng, không nền */
.dock .right .qt{
  height: 26px; min-width: 26px; padding: 0;
  border: none !important;
  background: transparent !important;
  display: inline-grid; place-items: center;
  border-radius: 50%;
  color: #ffffff !important;     /* quan trọng: fill trắng */
  transition: transform .12s ease;
}
.dock .right .qt:hover{ transform: translateY(-1px); }
.dock .right .qt:active{ transform: translateY(0); }

/* SVG bên trong lấy màu từ currentColor => trắng */
.dock .right .qt svg{
  width: 18px; height: 18px;
  fill: currentColor !important;
  color: inherit !important;
  opacity: 1;
  filter: drop-shadow(0 1px 1px rgba(0,0,0,.35));
}

/* Win controls: style cũ (white pill) */
.win-controls{ display: inline-flex; gap: 8px; }
.win-controls .ctrl{
  width: 34px; height: 28px;
  display: grid; place-items: center;
  border-radius: 10px;
  background: #ffffff !important;        /* luôn trắng */
  color: #0f141a !important;             /* icon tối */
  border: 1px solid rgba(0,0,0,.12) !important;
  box-shadow: 0 6px 16px rgba(0,0,0,.18);
  transition: background .15s ease, color .15s ease, transform .1s ease, border-color .15s ease;
}
.win-controls .ctrl:hover{
  background: #f6f7f9 !important;
}
.win-controls .ctrl:active{
  transform: translateY(1px);
}
/* Close có hover khác */
.win-controls .close:hover{
  background: #ffe9ee !important;
  color: #b42318 !important;
  border-color: rgba(255,0,0,.25) !important;
}
/* Sửa size icon cho đẹp trong nút trắng */
.win-controls .ctrl .ico{
  width: 16px; height: 16px;
}
/* Titlebar controls: giống ảnh 2 (glyph trắng, không nền) */
.win-controls{ display:inline-flex; gap:10px; padding-right:8px; }
.win-controls .ctrl{
  width:28px; height:22px;
  display:grid; place-items:center;
  border:0 !important; border-radius:6px;
  background: transparent !important;
  color: rgba(255,255,255,.92) !important;
  box-shadow:none !important;
  transition: background .12s ease, color .12s ease, transform .08s ease;
}
.win-controls .ctrl:hover{
  background: rgba(255,255,255,.08);      /* chỉ highlight nhẹ khi hover */
}
.win-controls .ctrl:active{
  background: rgba(255,255,255,.12);
  transform: translateY(0);
}
.win-controls .ctrl .ico{ width:14px; height:14px; }
.win-controls .ctrl .ico path,
.win-controls .ctrl .ico line{
  stroke: currentColor;                    /* trắng */
}

/* Icon dock góc phải: trắng trần */
.dock .right .qt{
  height:26px; min-width:26px; padding:0;
  border:none !important;
  background:transparent !important;
  display:inline-grid; place-items:center;
  color:#ffffff !important;
  border-radius:50%;
  transition: transform .12s ease;
}
.dock .right .qt:hover{ transform: translateY(-1px); }
.dock .right .qt:active{ transform: translateY(0); }
.dock .right .qt svg{
  width:18px; height:18px;
  fill: currentColor !important;
  color: inherit !important;
  opacity: 1;
  filter: drop-shadow(0 1px 1px rgba(0,0,0,.35));
}

/* Icon bánh răng giữa dock: to hơn */
.center-btn{
  width: 56px;            /* trước 48px */
  height: 56px;           /* trước 48px */
}

/* Kích thước icon (ảnh hoặc fallback SVG) bên trong */
#dockSettingsImg,
#dockSettingsFallback{
  width: 36px;            /* trước 30px */
  height: 36px;           /* trước 30px */
}

/* Thanh trắng trạng thái dưới icon — to hơn cho cân đối */
.center-indicator{
  width: 38px;            /* trước 32px */
  height: 5px;            /* dày hơn 1 chút */
  bottom: 6px;
}
.center-indicator.inactive{
  width: 22px;            /* trước 18px */
  opacity: .35;
  filter: blur(.2px);
}

/* Icon góc phải (Wi‑Fi/Volume/Cam) to hơn */
.dock .right .qt svg{
  width: 20px;            /* trước 18px */
  height: 20px;
}

/* ===== Context menu đổi wallpaper ===== */
.ctxmenu{
  position: fixed;
  min-width: 220px;
  max-width: 280px;
  padding: 6px;
  border-radius: 12px;
  background: rgba(32 38 42 / .50);
  border: 1px solid rgba(255 255 255 / .14);
  backdrop-filter: blur(14px) saturate(140%);
  -webkit-backdrop-filter: blur(14px) saturate(140%);
  box-shadow: 0 30px 80px rgba(0,0,0,.45), 0 2px 8px rgba(0,0,0,.25);
  color: var(--fg);
  z-index: 9999;
  animation: cm-fade .12s ease-out;
}
@keyframes cm-fade{ from{opacity:0; transform:scale(.98)} to{opacity:1; transform:scale(1)} }

.ctx-item{
  display: flex; align-items: center; gap: 10px;
  padding: 10px 12px;
  border-radius: 8px;
  cursor: pointer;
  user-select: none;
  transition: background .12s ease;
}
.ctx-item:hover{ background: rgba(255,255,255,.08); }
.ctx-item svg{ width: 16px; height: 16px; opacity: .95; }

.ctx-sep{
  height: 1px;
  margin: 6px;
  background: rgba(255,255,255,.12);
  border-radius: 1px;
}

/* Ẩn mặc định (JS sẽ toggle) */
.ctxmenu.hidden{ display: none; }

/* ===== Wallpaper parallax layer ===== */
/* Không dùng background-image trực tiếp để tiện transform */
.desktop{
  background-image: none !important;
  overflow: hidden;
}

/* Lớp ảnh di động bên trong desktop */
.desktop .wp-layer{
  position: absolute;
  inset: -3%;                         /* nới biên để dịch chuyển không hở mép */
  background-image: var(--wp);        /* vẫn dùng biến wallpaper hiện có */
  background-size: cover;
  background-position: center;
  will-change: transform;
  transform: translate3d(0,0,0) scale(1.06);
  pointer-events: none;               /* không chặn tương tác UI */
  z-index: 0;
}

/* Overlay gradient vẫn ở pseudo-element .desktop::after như cũ, nằm trên .wp-layer */

@media (prefers-reduced-motion: reduce){
  .desktop .wp-layer{ transform: translate3d(0,0,0) scale(1.06) !important; }
}

/* ===== Context menu đổi wallpaper ===== */
.ctxmenu{
  position: fixed;
  min-width: 220px;
  max-width: 280px;
  padding: 6px;
  border-radius: 12px;
  background: rgba(32 38 42 / .50);
  border: 1px solid rgba(255 255 255 / .14);
  backdrop-filter: blur(14px) saturate(140%);
  -webkit-backdrop-filter: blur(14px) saturate(140%);
  box-shadow: 0 30px 80px rgba(0,0,0,.45), 0 2px 8px rgba(0,0,0,.25);
  color: var(--fg);
  z-index: 9999;
  animation: cm-fade .12s ease-out;
}
@keyframes cm-fade{ from{opacity:0; transform:scale(.98)} to{opacity:1; transform:scale(1)} }

.ctx-item{
  display: flex; align-items: center; gap: 10px;
  padding: 10px 12px;
  border-radius: 8px;
  cursor: pointer;
  user-select: none;
  transition: background .12s ease;
}
.ctx-item:hover{ background: rgba(255,255,255,.08); }
.ctx-item svg{ width: 16px; height: 16px; opacity: .95; }

.ctx-sep{
  height: 1px;
  margin: 6px;
  background: rgba(255,255,255,.12);
  border-radius: 1px;
}

/* Ẩn mặc định (JS sẽ toggle) */
.ctxmenu.hidden{ display: none; }
/* ===== Wallpaper (parallax + Linux-like switch) — OVERRIDE ===== */
.desktop{
  position: fixed; inset: 0;
  background: none !important;
  overflow: hidden;
  z-index: 0;
}
.desktop .wp-layer{
  position: absolute; inset: -3%;
  background-image: var(--wp);
  background-size: cover;
  background-position: center;
  transform: translate3d(0,0,0) scale(1.06); /* parallax base */
  will-change: transform;
  pointer-events: none;
  z-index: 0;
}
.desktop::after{
  content:""; position:absolute; inset:0; pointer-events:none; z-index: 1;
  background:
    radial-gradient(1000px 50% at 50% 120%, rgba(0,0,0,.35), transparent 70%),
    linear-gradient(to top, rgba(0,0,0,.35), rgba(0,0,0,0) 30%);
}

/* lớp overlay cho ảnh mới */
.wp-next{
  position: absolute; inset: -3%;
  background-size: cover; background-position: center;
  pointer-events: none; z-index: 0;
  opacity: 0;
}

/* Cross-fade + blur + scale nhẹ (GNOME-like) */
@keyframes wpSwitchIn {
  0%   { opacity: 0; transform: translate3d(0,0,0) scale(1.10); filter: blur(12px) saturate(110%); }
  60%  { opacity: 1; transform: translate3d(0,0,0) scale(1.02); filter: blur(3px)  saturate(105%); }
  100% { opacity: 1; transform: translate3d(0,0,0) scale(1.00); filter: blur(0)    saturate(100%); }
}
.wp-next.enter{
  animation: wpSwitchIn 420ms cubic-bezier(.2,.85,.15,1) forwards;
}

/* Respect reduce-motion */
@media (prefers-reduced-motion: reduce){
  .desktop .wp-layer{ transform: translate3d(0,0,0) scale(1.06) !important; }
  .wp-next.enter{ animation: none !important; opacity:1; transform: none; filter:none; }
}

/* ===== Spotify window (themed teal, giống vibe ảnh) ===== */
.window.spotify{
  width: 1060px; height: 640px;
  left: calc(50% - 530px); top: 120px;
  z-index: 46;
  background: rgba(6, 40, 40, .55); /* xanh ngọc tối */
  border: 1px solid rgba(82, 220, 200, .30);
}
.titlebar.teal{
  background: linear-gradient(180deg, rgba(82,220,200,.25), rgba(82,220,200,0));
  border-bottom-color: rgba(82, 220, 200, .25);
}
.spotify-body{ display:grid; grid-template-rows: 1fr auto; gap: 12px; padding: 12px; }
.spotify-frame{
  position: relative; border-radius: 14px; overflow: hidden;
  border: 1px solid rgba(82, 220, 200, .25);
  box-shadow: 0 20px 50px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.05);
}
.spotify-frame iframe{
  width:100%; height:100%; display:block;
  filter: hue-rotate(160deg) saturate(105%) brightness(.92) contrast(1); /* tint xanh ngọc */
}
.spotify-frame .tint{
  position:absolute; inset:0; pointer-events:none;
  background: radial-gradient(80% 100% at 20% 0%, rgba(170,255,240,.08), transparent 60%);
  mix-blend-mode: screen; opacity:.7;
}
.spotify-toolbar{ display:flex; gap:8px; align-items:center; }
.spotify-toolbar .input{ flex: 1 1 auto; height: 38px; }
.btn.small.alt{ background: rgba(82,220,200,.2); border-color: rgba(82,220,200,.35); }

/* ===== Dock Spotify icon + indicator ===== */
.dock-app-wrap{ position: relative; width: 56px; display:flex; justify-content:center; align-items:center; }
.dock-app-btn{
  width: 48px; height: 48px; border:0; background:transparent; border-radius:50%;
  display:grid; place-items:center; color:#fff; transition: transform .12s ease;
}
.dock-app-btn:hover{ transform: translateY(-1px); }
.dock-app-btn:active{ transform: translateY(0); }
.dock-spotify-ico{ width:30px; height:30px; }
.indicator{ position:absolute; bottom:6px; left:50%; transform: translateX(-50%); width:38px; height:5px; border-radius:999px; background:#fff; box-shadow:0 2px 10px rgba(0,0,0,.45); transition: width .18s ease, opacity .18s ease, filter .18s ease; }
.indicator.inactive{ width:22px; opacity:.35; filter: blur(.2px); }

/* ===== Widgets layer ===== */
.widgets-layer{
  position: fixed; inset: 0; z-index: 35; pointer-events: none; /* widget tự bật pointer-events */
}
.widget{
  position: absolute; left: 100px; top: 100px; width: 420px; height: 220px;
  border-radius: 16px; backdrop-filter: blur(16px) saturate(140%); -webkit-backdrop-filter: blur(16px) saturate(140%);
  background: rgba(20, 28, 32, .40);
  border: 1px solid rgba(255,255,255,.14);
  box-shadow: 0 20px 60px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.06);
  color: var(--fg); user-select: none; pointer-events: auto;
}
.widget .w-head{
  position:absolute; left:0; right:0; top:0; height: 34px;
  display:flex; align-items:center; justify-content:space-between;
  padding: 0 10px; color: var(--fg-dim); font-weight: 700; font-size: 13px;
  border-bottom: 1px solid rgba(255,255,255,.08);
  cursor: move;
}
.widget .w-title{ opacity: .95; }
.widget .w-body{ position:absolute; left:10px; right:10px; top:40px; bottom:10px; overflow:hidden; }
.widget .resize{
  position:absolute; right: 6px; bottom: 6px; width: 14px; height: 14px;
  border-right: 2px solid rgba(255,255,255,.6);
  border-bottom: 2px solid rgba(255,255,255,.6);
  border-radius: 2px; cursor: nwse-resize;
}

/* Widget visualizer (cột) */
.w-bars{ display:flex; align-items:flex-end; gap:8px; height:100%; padding: 6px 8px; }
.w-bars .bar{
  width: 10px; border-radius: 4px 4px 0 0;
  background: linear-gradient(180deg, rgba(200,255,240,.95), rgba(200,255,240,.35));
  box-shadow: 0 2px 10px rgba(0,0,0,.35), inset 0 -1px 0 rgba(0,0,0,.25);
  height: 10%;
  transition: height .12s ease;
}


/* Right click menu for widgets */
.w-menu{
  position: fixed; min-width: 160px; padding: 6px; border-radius: 10px;
  background: rgba(32 38 42 / .5); border: 1px solid rgba(255,255,255,.14);
  backdrop-filter: blur(12px) saturate(140%);
  color: var(--fg); z-index: 9999;
}
.wm-item{ padding: 8px 10px; border-radius: 8px; cursor: pointer; }
.wm-item:hover{ background: rgba(255,255,255,.08); }

/* ===== Widget Picker ===== */
.widget-picker{
  position: fixed; left:50%; top:50%; transform: translate(-50%, -50%);
  width: 640px; max-width: calc(100vw - 40px);
  background: rgba(32 38 42 / .55);
  border: 1px solid rgba(255,255,255,.16);
  backdrop-filter: blur(18px) saturate(140%); -webkit-backdrop-filter: blur(18px) saturate(140%);
  border-radius: 16px; box-shadow: 0 30px 80px rgba(0,0,0,.45), 0 2px 8px rgba(0,0,0,.25);
  color: var(--fg); z-index: 70; padding: 12px 12px 14px;
}
.widget-picker.hidden{ display:none; }
.wp-head{ display:flex; align-items:center; justify-content:space-between; padding-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,.12); }
.wp-title{ font-weight: 800; font-size: 18px; }
.wp-close{ width:32px; height:28px; display:grid; place-items:center; border-radius:8px; background: rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.14); color: var(--fg); }
.wp-instr{ margin: 10px 0; color: var(--fg-dim); font-weight:700; }
.wp-grid{ display:grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
.wp-item{
  background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12);
  border-radius: 12px; padding: 10px; cursor: grab; user-select:none;
}
.wp-item:active{ cursor: grabbing; }
.wp-item .preview{ height: 90px; border-radius: 10px; display:grid; place-items:center; background: rgba(0,0,0,.25); border: 1px solid rgba(255,255,255,.08); }
.wp-item .preview.bars{ display:flex; align-items:flex-end; gap:6px; padding:6px 10px; }
.wp-item .preview .pbar{ width: 8px; height: 40px; background: linear-gradient(180deg, rgba(200,255,240,.95), rgba(200,255,240,.35)); border-radius: 4px 4px 0 0; }
.wp-name{ margin-top: 8px; font-weight: 700; }

/* ===== Context menu (wallpaper + add widget) ===== */
.ctxmenu{ position: fixed; min-width: 220px; padding: 6px; border-radius: 12px; background: rgba(32 38 42 / .50); border: 1px solid rgba(255 255 255 / .14); backdrop-filter: blur(14px) saturate(140%); box-shadow: 0 30px 80px rgba(0,0,0,.45), 0 2px 8px rgba(0,0,0,.25); color: var(--fg); z-index: 9999; }
.ctxmenu.hidden{ display:none; }
.ctx-item{ display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:8px; cursor:pointer; transition: background .12s; }
.ctx-item:hover{ background: rgba(255,255,255,.08); }
.ctx-sep{ height:1px; margin:6px; background: rgba(255,255,255,.12); border-radius:1px; }
.ctx-item svg{ width:16px; height:16px; }

/* ===== Spotify window (teal tidy) — OVERRIDE ===== */
.window.spotify{
  width: 1040px; height: 620px;
  left: calc(50% - 520px); top: 120px;
  z-index: 46;
  background: rgba(6, 40, 40, .52);
  border: 1px solid rgba(86, 230, 210, .35);
  box-shadow: 0 28px 80px rgba(0,0,0,.45), 0 2px 8px rgba(0,0,0,.25);
  border-radius: 18px;
}
.titlebar.teal{
  background: linear-gradient(180deg, rgba(86,230,210,.25), rgba(86,230,210,0));
  border-bottom-color: rgba(86,230,210,.25) !important;
}
.spotify-body{
  position: relative;
  height: calc(100% - var(--titlebar-h));
  padding: 12px;
  display: block;
}
.spotify-frame{
  position: absolute; left: 12px; right: 12px; top: 12px; bottom: 66px;
  border-radius: 14px; overflow: hidden;
  border: 1px solid rgba(86,230,210,.28);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.05), 0 20px 50px rgba(0,0,0,.45);
  background: rgba(0,0,0,.35);
}
.spotify-frame iframe{
  width:100%; height:100%; display:block;
  filter: hue-rotate(155deg) saturate(106%) brightness(.92) contrast(1.02);
}
.spotify-frame .tint{
  position:absolute; inset:0; pointer-events:none;
  background: radial-gradient(90% 120% at 20% 0%, rgba(170,255,240,.09), transparent 60%);
  mix-blend-mode: screen; opacity:.7;
}

/* Toolbar dính đáy */
.spotify-toolbar{
  position: absolute; left: 12px; right: 12px; bottom: 12px;
  display:flex; gap:8px; align-items:center;
  padding: 8px; border-radius: 12px;
  background: rgba(6,40,40,.45);
  border: 1px solid rgba(86,230,210,.28);
  backdrop-filter: blur(12px) saturate(140%);
  -webkit-backdrop-filter: blur(12px) saturate(140%);
}
.spotify-toolbar .input{
  flex: 1 1 auto; height: 38px; border-radius:10px;
  border:1px solid rgba(255,255,255,.16);
  background: rgba(255,255,255,.06); color: var(--fg); padding: 0 10px; font-weight:700;
}
.btn.small{ padding: 8px 12px; border-radius: 10px; border:1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.22); color: var(--fg); font-weight:700; cursor:pointer; }
.btn.small.alt{ background: rgba(86,230,210,.2); border-color: rgba(86,230,210,.35); }

/* Dock Spotify icon + indicator (giữ như trước, tinh nhẹ) */
.dock-app-wrap{ position: relative; width: 56px; display:flex; justify-content:center; align-items:center; }
.dock-app-btn{
  width: 48px; height: 48px; border:0; background:transparent; border-radius:50%;
  display:grid; place-items:center; color:#fff; transition: transform .12s ease;
}
.dock-app-btn:hover{ transform: translateY(-1px); }
.dock-app-btn:active{ transform: translateY(0); }
.dock-spotify-ico{ width:30px; height:30px; }
.indicator{ position:absolute; bottom:6px; left:50%; transform: translateX(-50%); width:38px; height:5px; border-radius:999px; background:#fff; box-shadow:0 2px 10px rgba(0,0,0,.45); transition: width .18s ease, opacity .18s ease, filter .18s ease; }
.indicator.inactive{ width:22px; opacity:.35; filter: blur(.2px); }

/* Context menu — chỉ 1 menu, style giữ nguyên (nếu có nhiều block cũ, block này sẽ override) */
.ctxmenu{ position: fixed; min-width: 220px; padding: 6px; border-radius: 12px; background: rgba(32 38 42 / .50); border: 1px solid rgba(255 255 255 / .14); backdrop-filter: blur(14px) saturate(140%); box-shadow: 0 30px 80px rgba(0,0,0,.45), 0 2px 8px rgba(0,0,0,.25); color: var(--fg); z-index: 9999; }
.ctxmenu.hidden{ display:none; }
.ctx-item{ display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:8px; cursor:pointer; transition: background .12s; }
.ctx-item:hover{ background: rgba(255,255,255,.08); }
.ctx-sep{ height:1px; margin:6px; background: rgba(255,255,255,.12); border-radius:1px; }
.ctx-item svg{ width:16px; height:16px; }

/* ===== PATCH START: Spotify + Specs + Context Menu (verified braces) ===== */

/* Spotify window (teal tidy) */
.window.spotify{
  width: 1040px; height: 620px;
  left: calc(50% - 520px); top: 120px;
  z-index: 46;
  background: rgba(6, 40, 40, .52);
  border: 1px solid rgba(86, 230, 210, .35);
  box-shadow: 0 28px 80px rgba(0,0,0,.45), 0 2px 8px rgba(0,0,0,.25);
  border-radius: 18px;
}
.titlebar.teal{
  background: linear-gradient(180deg, rgba(86,230,210,.25), rgba(86,230,210,0));
  border-bottom-color: rgba(86,230,210,.25) !important;
}
.spotify-body{
  position: relative;
  height: calc(100% - var(--titlebar-h));
  padding: 12px;
}
.spotify-frame{
  position: absolute; left: 12px; right: 12px; top: 12px; bottom: 66px;
  border-radius: 14px; overflow: hidden;
  border: 1px solid rgba(86,230,210,.28);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.05), 0 20px 50px rgba(0,0,0,.45);
  background: rgba(0,0,0,.35);
}
.spotify-frame iframe{
  width:100%; height:100%; display:block;
  filter: hue-rotate(155deg) saturate(106%) brightness(.92) contrast(1.02);
}
.spotify-frame .tint{
  position:absolute; inset:0; pointer-events:none;
  background: radial-gradient(90% 120% at 20% 0%, rgba(170,255,240,.09), transparent 60%);
  mix-blend-mode: screen; opacity:.7;
}
.spotify-toolbar{
  position: absolute; left: 12px; right: 12px; bottom: 12px;
  display:flex; gap:8px; align-items:center;
  padding: 8px; border-radius: 12px;
  background: rgba(6,40,40,.45);
  border: 1px solid rgba(86,230,210,.28);
  backdrop-filter: blur(12px) saturate(140%);
  -webkit-backdrop-filter: blur(12px) saturate(140%);
}
.spotify-toolbar .input{
  flex: 1 1 auto; height: 38px; border-radius:10px;
  border:1px solid rgba(255,255,255,.16);
  background: rgba(255,255,255,.06); color: var(--fg); padding: 0 10px; font-weight:700;
}
.btn.small{
  padding: 8px 12px; border-radius: 10px;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.22);
  color: var(--fg);
  font-weight:700; cursor:pointer;
}
.btn.small.alt{
  background: rgba(86,230,210,.2);
  border-color: rgba(86,230,210,.35);
}

/* Dock Spotify */
.dock-app-wrap{ position: relative; width: 56px; display:flex; justify-content:center; align-items:center; }
.dock-app-btn{
  width: 48px; height: 48px; border:0; background:transparent; border-radius:50%;
  display:grid; place-items:center; color:#fff; transition: transform .12s ease;
}
.dock-app-btn:hover{ transform: translateY(-1px); }
.dock-app-btn:active{ transform: translateY(0); }
.dock-spotify-ico{ width:30px; height:30px; }
.indicator{
  position:absolute; bottom:6px; left:50%; transform: translateX(-50%);
  width:38px; height:5px; border-radius:999px; background:#fff;
  box-shadow:0 2px 10px rgba(0,0,0,.45);
  transition: width .18s ease, opacity .18s ease, filter .18s ease;
}
.indicator.inactive{ width:22px; opacity:.35; filter: blur(.2px); }

/* FIX: ép Specifications về layout 3 chip */
.g-spec .spec-grid{ display:none !important; }
.specs-card{ padding:14px 14px 12px; border-radius: var(--radius-card); }
.spec-title{
  font-weight:800; font-size:16px; color:var(--fg);
  margin:0 0 10px 2px; letter-spacing:.2px;
}
.spec-chips{ display:grid; grid-template-columns: repeat(3, 1fr); gap:14px; }
.spec-chip{
  background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12);
  border-radius: 10px; padding:10px 12px; min-height:64px;
  display:flex; flex-direction:column; justify-content:center;
  box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
}
.chip-head{
  display:flex; align-items:center; gap:8px;
  color:var(--fg-dim); font-weight:700; font-size:13px; letter-spacing:.2px; margin-bottom:2px;
}
.chip-head .sq{
  width:8px; height:8px; border-radius:2px;
  background: rgba(210,220,228,.95); box-shadow: 0 1px 0 rgba(0,0,0,.2) inset;
}
.chip-main{ font-weight:800; color:var(--fg); line-height:1.15; }
.chip-sub{ opacity:.9; margin-top:2px; font-weight:700; color:var(--fg); font-size:13px; }

/* ONE Context menu only */
#ctxMenu.ctxmenu{
  position: fixed; min-width: 220px; padding: 6px; border-radius: 12px;
  background: rgba(32 38 42 / .50);
  border: 1px solid rgba(255 255 255 / .14);
  backdrop-filter: blur(14px) saturate(140%);
  box-shadow: 0 30px 80px rgba(0,0,0,.45), 0 2px 8px rgba(0,0,0,.25);
  color: var(--fg); z-index: 9999;
}
#ctxMenu.hidden{ display:none; }
#ctxMenu .ctx-item{
  display:flex; align-items:center; gap:10px;
  padding:10px 12px; border-radius:8px; cursor:pointer;
  transition: background .12s;
}
#ctxMenu .ctx-item:hover{ background: rgba(255,255,255,.08); }
#ctxMenu .ctx-sep{ height:1px; margin:6px; background: rgba(255,255,255,.12); border-radius:1px; }
#ctxMenu .ctx-item svg{ width:16px; height:16px; }

/* ===== PATCH END ===== */

/* Ẩn UI cũ nếu còn */
.center-btn, .center-indicator { display:none !important; }

/* Cụm icon giữa dock */
.center-abs{
  position:absolute; left:50%; top:0; transform:translateX(-50%);
  height:100%; display:flex !important; align-items:center; justify-content:center;
  pointer-events:none; z-index:1;
}
.task-center{ display:flex; gap:16px; pointer-events:auto; }
.task-item{ position:relative; width:56px; height:56px; display:flex; align-items:center; justify-content:center; }
.task-btn{
  width:56px; height:56px; border:0; background:transparent; border-radius:50%;
  display:grid; place-items:center; transition: transform .12s ease;
}
.task-btn:hover{ transform: translateY(-1px); }
.task-btn:active{ transform: translateY(0); }

/* Size icon */
#dockSettingsImg, #dockSettingsFallback{ width:36px; height:36px; }
#dockSpotifyImg, #dockSpotifyFallback{ width:36px; height:36px; }
.dock-spotify-ico{ color:#fff; filter: drop-shadow(0 1px 1px rgba(0,0,0,.35)); }

/* Vạch trắng dưới mỗi icon */
.task-ind{
  position:absolute; bottom:6px; left:50%; transform:translateX(-50%);
  width:38px; height:5px; border-radius:999px; background:#fff;
  box-shadow:0 2px 10px rgba(0,0,0,.45);
  transition: width .18s ease, opacity .18s ease, filter .18s ease;
}
.task-ind.inactive{ width:22px; opacity:.35; filter: blur(.2px); }

/* Fix focus square + tránh chồng icon */
.task-btn { outline: none !important; }
.task-btn:focus,
.task-btn:focus-visible { outline: none !important; box-shadow: none !important; }

.task-btn img,
.task-btn svg { display: block; width: 36px; height: 36px; }

/* Chỉ một icon Spotify được hiển thị mỗi lần */
#dockSpotifyImg { display: none; }      /* JS sẽ bật khi có ảnh */
#dockSpotifyFallback { display: block; } /* fallback SVG mặc định */

/* Indicators cho cả Settings + Spotify (active dài, inactive ngắn/mờ) */
#indSettings, #indSpotify, .task-ind{
  position:absolute; bottom:6px; left:50%; transform:translateX(-50%);
  width:38px; height:5px; border-radius:999px; background:#fff;
  box-shadow:0 2px 10px rgba(0,0,0,.45);
  transition: width .18s ease, opacity .18s ease, filter .18s ease;
}
#indSettings.inactive, #indSpotify.inactive, .task-ind.inactive{
  width:22px; opacity:.35; filter:blur(.2px);
}

/* Layout cụm icon giữa dock: đều và cân */
.center-abs{
  position:absolute; left:50%; top:0; transform:translateX(-50%);
  height:100%; display:flex !important; align-items:center; justify-content:center;
  pointer-events:none; z-index:1;
}
.task-center{ display:flex; gap:22px; pointer-events:auto; }
.task-item{ position:relative; width:60px; height:56px; display:flex; align-items:center; justify-content:center; }
.task-btn{
  width:56px; height:56px; border:0; background:transparent; border-radius:50%;
  display:grid; place-items:center; transition: transform .12s ease;
  outline:none !important; box-shadow:none !important;
}
.task-btn:hover{ transform:translateY(-1px); }
.task-btn:active{ transform:translateY(0); }

/* Kích thước icon trong nút */
.task-btn img, .task-btn svg{ display:block; width:34px; height:34px; }
#dockSettingsImg, #dockSettingsFallback,
#dockSpotifyImg,  #dockSpotifyFallback{ width:34px; height:34px; }

/* Ẩn UI cũ nếu còn */
.center-btn, .center-indicator{ display:none !important; }

/* Dock center — Windows 11 spacing */
.center-abs{
  position:absolute; left:50%; top:0; transform:translateX(-50%);
  height:100%; display:flex !important; align-items:center; justify-content:center;
  pointer-events:none; z-index:1;
}
.task-center{ display:flex; gap: 10px; pointer-events:auto; }     /* sát hơn */
.task-item{ position:relative; width:52px; height:52px; display:flex; align-items:center; justify-content:center; }
.task-btn{
  width:48px; height:48px; border:0; background:transparent; border-radius:10px;
  display:grid; place-items:center; transition: transform .12s ease;
  outline:none !important; box-shadow:none !important;
}
.task-btn:hover{ transform: translateY(-2px); }
.task-btn:active{ transform: translateY(0); }
.task-btn img, .task-btn svg{ width:28px; height:28px; display:block; }

/* Indicator nhỏ kiểu Win11 */
.task-ind, #indSettings, #indSpotify{
  position:absolute; bottom:5px; left:50%; transform:translateX(-50%);
  width:22px; height:3px; border-radius:3px; background:#fff;
  box-shadow:0 2px 10px rgba(0,0,0,.45);
  transition: width .18s ease, opacity .18s ease, filter .18s ease;
}
.task-ind.inactive, #indSettings.inactive, #indSpotify.inactive{
  width:10px; opacity:.45; filter:blur(.2px);
}

/* Ẩn UI dock cũ nếu còn */
.center-btn, .center-indicator{ display:none !important; }

/* ===== Dock center — Windows 11 grid, bigger & balanced ===== */
:root{
  --dock-gap: 10px;     /* khoảng cách giữa ô */
  --dock-cell: 64px;    /* kích thước ô (cell) */
  --dock-btn: 56px;     /* kích thước nút bấm bên trong ô */
  --dock-ico: 40px;     /* kích thước icon (SVG/IMG) */
  --dock-ind-w: 26px;   /* chiều dài indicator khi active */
  --dock-ind-h: 4px;    /* độ dày indicator */
}

/* Ẩn UI dock cũ nếu còn */
.center-btn, .center-indicator{ display:none !important; }

/* Khung giữa dock chuyển thành grid */
.center-abs{
  position:absolute; left:50%; top:0; transform:translateX(-50%);
  height:100%;
  display:grid !important;
  align-items:center; justify-items:center;
  pointer-events:none; z-index:1;
}

/* Container icon: grid theo cột, mỗi cell cùng kích thước */
.task-center{
  display:grid;
  grid-auto-flow: column;
  grid-auto-columns: var(--dock-cell);
  gap: var(--dock-gap);
  pointer-events:auto;
  align-items:end; justify-content:center;
}

/* Mỗi item là 1 cell vuông, nội dung căn giữa hoàn hảo */
.task-item{
  width: var(--dock-cell);
  height: var(--dock-cell);
  display:grid;
  grid-template-rows: 1fr auto;    /* icon phía trên, indicator phía dưới */
  justify-items:center;
  align-items:center;
  position:relative;
}

/* Nút bấm (không padding), icon đặt giữa */
.task-btn{
  width: var(--dock-btn);
  height: var(--dock-btn);
  border:0;
  background:transparent;
  border-radius:12px;
  display:grid; place-items:center;
  transition: transform .12s ease;
  outline:none !important; box-shadow:none !important;
}
.task-btn:hover{ transform: translateY(-2px); }
.task-btn:active{ transform: translateY(0); }

/* Icon trong nút – cùng một size cho IMG/SVG */
.task-btn img, .task-btn svg{
  width: var(--dock-ico);
  height: var(--dock-ico);
  display:block;
}

/* Indicator kiểu Windows 11 */
.task-ind, #indSettings, #indSpotify{
  position:absolute; left:50%; bottom: 6px; transform:translateX(-50%);
  width: var(--dock-ind-w);
  height: var(--dock-ind-h);
  border-radius: 999px;
  background: #fff;
  box-shadow: 0 2px 10px rgba(0,0,0,.45);
  transition: width .18s ease, opacity .18s ease, filter .18s ease;
}
.task-ind.inactive, #indSettings.inactive, #indSpotify.inactive{
  width: calc(var(--dock-ind-w) * .42);
  opacity: .45;
  filter: blur(.2px);
}
/* Indicator animate ngay, không delay */
.ind, .task-ind { transition-delay: 0s !important; animation-delay: 0s !important; }


/* Indicator chạy ngay, không delay */
.ind, .task-ind { transition-delay: 0s !important; animation-delay: 0s !important; }
/* Cho phép click vào icon giữa dock */
.center-abs{ pointer-events:none; }
#taskCenter{ pointer-events:auto; }
.task-btn{ pointer-events:auto; }

/* indicator phản hồi ngay, không delay */
.ind, .task-ind { transition-delay: 0s !important; animation-delay: 0s !important; }

/* cho phép click vào icon giữa dock */
.center-abs{ pointer-events:none; }
#taskCenter, .task-btn{ pointer-events:auto; }

/* Dock icons: show/hide bằng class has-img cho cả task-btn (giữa) và logo (trái) */
.task-btn img, .task-btn svg,
.logo     img, .logo     svg{
  width: var(--dock-ico, 36px);
  height: var(--dock-ico, 36px);
  object-fit: contain;
  display: none;
}
.task-btn.has-img img, .logo.has-img img{ display:block; }
.task-btn.has-img svg, .logo.has-img svg{ display:none; }
.task-btn:not(.has-img) svg, .logo:not(.has-img) svg{ display:block; }

/* Cho phép click icon giữa dock + indicator không delay */
.center-abs{ pointer-events:none; }
#taskCenter, .task-btn{ pointer-events:auto; }
.ind, .task-ind{ transition-delay:0s !important; animation-delay:0s !important; }

/* ===== Dock icons — show/hide theo class has-img ===== */
.center-abs{ pointer-events:none; }
#taskCenter,.task-btn{ pointer-events:auto; }
.task-btn img,.task-btn svg{
  width: var(--dock-ico, 36px); height: var(--dock-ico, 36px);
  object-fit: contain; display:none;
}
.task-btn.has-img img{ display:block; }
.task-btn:not(.has-img) svg{ display:block; }

/* indicator no-delay (bạn vẫn giữ transition nếu thích) */
.ind,.task-ind{ transition-delay:0s !important; animation-delay:0s !important; }

/* ===== Widget Weather ===== */
.widget.weather .w-head{ height:34px; display:flex; align-items:center; justify-content:space-between;
  padding:0 10px; color:#cfd6de; font-weight:700; border-bottom:1px solid rgba(255,255,255,.08); cursor:move; }
.widget.weather .w-body{ position:absolute; inset:40px 10px 10px 10px; overflow:hidden; }
.widget.weather .bg{ position:absolute; inset:0; background-size:cover; background-position:center; opacity:.35; filter:blur(2px); border-radius:10px; }
.widget.weather .inner{ position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:4px;
  font-weight:800; text-shadow:0 10px 30px rgba(0,0,0,.45); }
.widget.weather .city{ font-size:16px; opacity:.95; }
.widget.weather .temp{ font-size:54px; }
.widget.weather .desc{ font-size:13px; opacity:.9; }
.widget.weather .resize{ position:absolute; right:6px; bottom:6px; width:14px; height:14px; border-right:2px solid rgba(255,255,255,.6); border-bottom:2px solid rgba(255,255,255,.6); border-radius:2px; cursor:nwse-resize; }

/* ===== AI overlay Alt+I (liquid + ring + chat popup) ===== */
.ai-veil{ position:fixed; inset:0; z-index:90; pointer-events:none; display:none; }
.ai-veil.on{ display:block; }
.ai-edges{ position:absolute; inset:0; border:4px solid transparent; border-radius:20px; padding:4px;
  background: conic-gradient(from 0deg, #ff7ad9, #76e0ff, #9dff7c, #ffda6b, #ff7ad9);
  -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite: xor; mask-composite: exclude;
  opacity:.85; filter:hue-rotate(0); animation: ai-ring 7s linear infinite; }
@keyframes ai-ring{ to{ filter:hue-rotate(360deg); } }

.ai-liquid{ position:absolute; inset:0; filter:url(#goo-ai); pointer-events:none; }
.ai-blob{ position:absolute; width:180px; height:180px; border-radius:50%; mix-blend-mode:screen; opacity:.7;
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.65), rgba(255,255,255,.15));
  animation: ai-float 12s ease-in-out infinite; }
.ai-blob.b1{ left:12%; top:24%; animation-duration:13s; }
.ai-blob.b2{ left:62%; top:32%; animation-duration:12s; }
.ai-blob.b3{ left:32%; top:62%; animation-duration:14s; }
.ai-blob.b4{ left:72%; top:66%; animation-duration:15s; }
@keyframes ai-float{ 0%,100%{ transform:translate(0,0) scale(1) } 50%{ transform:translate(40px,-30px) scale(1.15) } }

.ai-pill{ position:fixed; left:50%; top:14px; transform:translateX(-50%); z-index:95; display:none; }
.ai-pill.on{ display:block; }
.ai-pill .pill{
  display:flex; align-items:center; gap:10px; padding:8px 12px; border-radius:20px; border:1px solid rgba(255,255,255,.2);
  background: rgba(18,18,22,.65); color:#fff; backdrop-filter: blur(16px); }
.ai-dot{ width:8px; height:8px; border-radius:50%; background:#5dffb5; box-shadow:0 0 10px #5dffb5; }
.ai-actions button{ border:0; background:transparent; color:#fff; font-size:16px; margin-left:6px; cursor:pointer; }

.ai-chat{ position:fixed; left:50%; top:50%; transform:translate(-50%,-50%) scale(.98);
  width:min(880px, calc(100vw - 40px)); height:min(600px, calc(100vh - 80px));
  border-radius:18px; border:1px solid rgba(255,255,255,.2); background:rgba(22,22,26,.6);
  backdrop-filter: blur(18px) saturate(140%); -webkit-backdrop-filter: blur(18px) saturate(140%);
  box-shadow:0 30px 80px rgba(0,0,0,.5), 0 2px 8px rgba(0,0,0,.25);
  display:none; z-index:100; color:#fff; }
.ai-chat.on{ display:grid; grid-template-rows:auto 1fr auto; animation: ai-pop .18s cubic-bezier(.2,.85,.15,1) both; }
@keyframes ai-pop{ from{ opacity:0; transform:translate(-50%,-50%) scale(.96) } to{ opacity:1; transform:translate(-50%,-50%) scale(1) } }
.ai-chat .head{ height:48px; display:flex; align-items:center; justify-content:space-between; padding:0 12px; border-bottom:1px solid rgba(255,255,255,.12); }
.ai-chat .prompts{ padding:10px; display:flex; flex-wrap:wrap; gap:8px; }
.ai-chip{ padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.14); background:rgba(255,255,255,.08); cursor:pointer; }
.ai-chat .msgs{ padding:12px; overflow:auto; }
.ai-chat .msg{ padding:10px 12px; border-radius:12px; margin:6px 0; max-width:80%; box-shadow: 0 6px 16px rgba(0,0,0,.25); }
.ai-chat .me{ background:rgba(255,255,255,.10); margin-left:auto; }
.ai-chat .ai{ background:rgba(255,255,255,.06); }
.ai-chat .typewriter span{ border-right:2px solid rgba(255,255,255,.6); animation: tw-blink 1s infinite; }
@keyframes tw-blink{ 0%,100%{ border-color:transparent } 50%{ border-color:rgba(255,255,255,.6) } }
.ai-chat .input{ padding:10px; display:flex; gap:8px; border-top:1px solid rgba(255,255,255,.12); }
.ai-chat input[type=text]{ flex:1 1 auto; height:40px; border-radius:10px; border:1px solid rgba(255,255,255,.16); background:rgba(255,255,255,.08); color:#fff; padding:0 10px; font-weight:700; }
.ai-chat button.send{ height:40px; padding:0 12px; border-radius:10px; border:1px solid rgba(255,255,255,.16); background:#fff; color:#111; font-weight:800; }

/* ===== AI overlay (Apple‑like liquid + ring) ===== */
.ai-root{ position:fixed; inset:0; z-index:140; pointer-events:none; display:none; }
.ai-root.on{ display:block; }

/* Edge neon ring quanh viền */
.ai-ring{
  position:absolute; inset:0; border:4px solid transparent; border-radius:20px; padding:4px;
  background: conic-gradient(from 0deg, #ff7ad9, #76e0ff, #9dff7c, #ffda6b, #ff7ad9);
  -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite: xor; mask-composite: exclude;
  opacity:.9; filter:hue-rotate(0);
  animation: ai-ring 7s linear infinite;
}
@keyframes ai-ring{ to{ filter:hue-rotate(360deg) } }

/* Liquid splash (metaballs) */
.ai-splash{ position:absolute; inset:0; filter:url(#goo-ai); pointer-events:none; }
.ai-blob{
  position:absolute; width:200px; height:200px; border-radius:50%;
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.75), rgba(255,255,255,.15));
  mix-blend-mode:screen; opacity:.85; transform:translate(-50%,-50%) scale(.2);
}
.ai-root.on .ai-blob{ animation: ai-burst 680ms cubic-bezier(.2,.85,.15,1) both; }
.ai-blob.b1{ left:50%; top:50%; animation-delay: 0ms; }
.ai-blob.b2{ left:50%; top:50%; animation-delay: 40ms; }
.ai-blob.b3{ left:50%; top:50%; animation-delay: 80ms; }
.ai-blob.b4{ left:50%; top:50%; animation-delay:120ms; }

@keyframes ai-burst{
  0%   { transform:translate(-50%,-50%) scale(.2);   filter:blur(16px); }
  55%  { transform:translate(calc(-50% - 22vw), calc(-50% - 14vh)) scale(1.15); filter:blur(6px); }
  100% { transform:translate(calc(-50% + 24vw),  calc(-50% + 18vh))  scale(1.00); filter:blur(0); }
}

/* Top pill “Listening…” */
.ai-pill{ position:fixed; left:50%; top:14px; transform:translateX(-50%); z-index:150; display:none; }
.ai-pill.on{ display:block; }
.ai-pill .pill{
  display:flex; align-items:center; gap:10px; padding:8px 12px; border-radius:20px;
  border:1px solid rgba(255,255,255,.2);
  background: rgba(18,18,22,.65); color:#fff; backdrop-filter: blur(16px);
}
.ai-dot{ width:8px; height:8px; border-radius:50%; background:#5dffb5; box-shadow:0 0 10px #5dffb5; }
.ai-actions button{ border:0; background:transparent; color:#fff; font-size:16px; margin-left:6px; cursor:pointer; }

/* Chat popup */
.ai-chat{ position:fixed; left:50%; top:50%; transform:translate(-50%,-50%) scale(.98);
  width:min(880px, calc(100vw - 40px)); height:min(600px, calc(100vh - 80px));
  border-radius:18px; border:1px solid rgba(255,255,255,.2); background:rgba(22,22,26,.6);
  backdrop-filter: blur(18px) saturate(140%); -webkit-backdrop-filter: blur(18px) saturate(140%);
  box-shadow:0 30px 80px rgba(0,0,0,.5), 0 2px 8px rgba(0,0,0,.25);
  display:none; z-index:160; color:#fff;
}
.ai-chat.on{ display:grid; grid-template-rows:auto auto 1fr auto; animation: ai-pop .18s cubic-bezier(.2,.85,.15,1) both; }
@keyframes ai-pop{ from{ opacity:0; transform:translate(-50%,-50%) scale(.96) } to{ opacity:1; transform:translate(-50%,-50%) scale(1) } }
.ai-chat .head{ height:48px; display:flex; align-items:center; justify-content:space-between; padding:0 12px; border-bottom:1px solid rgba(255,255,255,.12); }
.ai-chat .prompts{ padding:10px; display:flex; flex-wrap:wrap; gap:8px; }
.ai-chip{ padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.14); background:rgba(255,255,255,.08); cursor:pointer; }
.ai-chat .msgs{ padding:12px; overflow:auto; }
.ai-chat .msg{ padding:10px 12px; border-radius:12px; margin:6px 0; max-width:80%; box-shadow: 0 6px 16px rgba(0,0,0,.25); white-space:pre-wrap; }
.ai-chat .me{ background:rgba(255,255,255,.10); margin-left:auto; }
.ai-chat .ai{ background:rgba(255,255,255,.06); }
.ai-chat .input{ padding:10px; display:flex; gap:8px; border-top:1px solid rgba(255,255,255,.12); }
.ai-chat input[type=text]{ flex:1 1 auto; height:40px; border-radius:10px; border:1px solid rgba(255,255,255,.16); background:rgba(255,255,255,.08); color:#fff; padding:0 10px; font-weight:700; }
.ai-chat button.send{ height:40px; padding:0 12px; border-radius:10px; border:1px solid rgba(255,255,255,.16); background:#fff; color:#111; font-weight:800; }

/* typewriter caret */
.ai-typing{ border-right:2px solid rgba(255,255,255,.6); animation: tw-blink 1s infinite; }
@keyframes tw-blink{ 0%,100%{ border-color:transparent } 50%{ border-color:rgba(255,255,255,.6) } }

@media (prefers-reduced-motion: reduce){
  .ai-root.on .ai-blob{ animation:none; transform:translate(-50%,-50%) scale(1); }
}
/* Dock icon hiển thị theo class has-img (khóa mọi xung đột) */
#dock .task-btn img,
#dock .task-btn svg{ display:none !important; width:var(--dock-ico,36px); height:var(--dock-ico,36px); object-fit:contain; }
#dock .task-btn.has-img img{ display:block !important; }
#dock .task-btn:not(.has-img) svg{ display:block !important; }

/* Cho phép click vào icon giữa dock + indicator no‑delay */
.center-abs{ pointer-events:none; }
#taskCenter,.task-btn{ pointer-events:auto; }
.ind,.task-ind{ transition-delay:0s !important; animation-delay:0s !important; }

/* Dock icons: show theo class has-img để không bị rule khác đè */
#dock .task-btn img,
#dock .task-btn svg{ display:none !important; width:var(--dock-ico,36px); height:var(--dock-ico,36px); object-fit:contain; }
#dock .task-btn.has-img img{ display:block !important; }
#dock .task-btn:not(.has-img) svg{ display:block !important; }

/* Cho phép click ở giữa dock + indicator no‑delay */
.center-abs{ pointer-events:none; }
#taskCenter,.task-btn{ pointer-events:auto; }
.ind,.task-ind{ transition-delay:0s !important; animation-delay:0s !important; }

/* Nút AI góc phải (click = bật AI, right‑click = đổi icon, Shift+click = reset icon) */
.ai-fab{
  position:fixed; top:10px; right:12px; z-index:170;
  width:38px; height:38px; border-radius:10px;
  display:grid; place-items:center; cursor:pointer;
  border:1px solid rgba(255,255,255,.18); background:rgba(0,0,0,.28);
  backdrop-filter: blur(10px);
  box-shadow: 0 8px 20px rgba(0,0,0,.35);
  transition: transform .12s ease;
}
.ai-fab:hover{ transform: translateY(-1px); }
.ai-fab img, .ai-fab svg{ width:22px; height:22px; display:none; }
.ai-fab.has-img img{ display:block; }
.ai-fab:not(.has-img) svg{ display:block; }

/* ===== ZD_AI (Apple‑style liquid + ring + chat) ===== */
.zd-ai-root{ position:fixed; inset:0; z-index:140; pointer-events:none; display:none; }
.zd-ai-root.on{ display:block; }

/* neon ring chạy quanh viền */
.zd-ai-ring{
  position:absolute; inset:0; border:4px solid transparent; border-radius:20px; padding:4px;
  background:conic-gradient(from 0deg, #ff7ad9, #76e0ff, #9dff7c, #ffda6b, #ff7ad9);
  -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite: xor; mask-composite: exclude;
  opacity:.9; filter:hue-rotate(0); animation: zdai-ring 7s linear infinite;
}
@keyframes zdai-ring{ to{ filter:hue-rotate(360deg); } }

/* liquid splash (metaballs) */
.zd-ai-splash{ position:absolute; inset:0; filter:url(#zd-ai-goo); pointer-events:none; }
.zd-ai-blob{
  position:absolute; width:200px; height:200px; border-radius:50%;
  background:radial-gradient(circle at 30% 30%, rgba(255,255,255,.75), rgba(255,255,255,.15));
  mix-blend-mode:screen; opacity:.85; transform:translate(-50%,-50%) scale(.2);
}
.zd-ai-root.on .zd-ai-blob{ animation: zdai-burst 680ms cubic-bezier(.2,.85,.15,1) both; }
.zd-ai-blob.b1{ left:50%; top:50%; animation-delay:0ms; }
.zd-ai-blob.b2{ left:50%; top:50%; animation-delay:40ms; }
.zd-ai-blob.b3{ left:50%; top:50%; animation-delay:80ms; }
.zd-ai-blob.b4{ left:50%; top:50%; animation-delay:120ms; }
@keyframes zdai-burst{
  0%   { transform:translate(-50%,-50%) scale(.2);  filter:blur(16px); }
  55%  { transform:translate(calc(-50% - 22vw), calc(-50% - 14vh)) scale(1.15); filter:blur(6px); }
  100% { transform:translate(calc(-50% + 24vw),  calc(-50% + 18vh)) scale(1.00); filter:blur(0); }
}

/* pill top */
.zd-ai-pill{ position:fixed; left:50%; top:14px; transform:translateX(-50%); z-index:150; display:none; }
.zd-ai-pill.on{ display:block; }
.zd-ai-pill .pill{
  display:flex; align-items:center; gap:10px; padding:8px 12px; border-radius:20px;
  border:1px solid rgba(255,255,255,.2);
  background:rgba(18,18,22,.65); color:#fff; backdrop-filter:blur(16px);
}
.zd-ai-dot{ width:8px; height:8px; border-radius:50%; background:#5dffb5; box-shadow:0 0 10px #5dffb5; }
.zd-ai-actions button{ border:0; background:transparent; color:#fff; font-size:16px; margin-left:6px; cursor:pointer; }

/* chat popup */
.zd-ai-chat{
  position:fixed; left:50%; top:50%; transform:translate(-50%,-50%) scale(.98);
  width:min(880px, calc(100vw - 40px)); height:min(600px, calc(100vh - 80px));
  border-radius:18px; border:1px solid rgba(255,255,255,.2);
  background:rgba(22,22,26,.6); color:#fff;
  box-shadow:0 30px 80px rgba(0,0,0,.5), 0 2px 8px rgba(0,0,0,.25);
  backdrop-filter:blur(18px) saturate(140%); -webkit-backdrop-filter:blur(18px) saturate(140%);
  display:none; z-index:160;
}
.zd-ai-chat.on{ display:grid; grid-template-rows:auto auto 1fr auto; animation: zdai-pop .18s cubic-bezier(.2,.85,.15,1) both; }
@keyframes zdai-pop{ from{ opacity:0; transform:translate(-50%,-50%) scale(.96) } to{ opacity:1; transform:translate(-50%,-50%) scale(1) } }
.zd-ai-chat .head{ height:48px; display:flex; align-items:center; justify-content:space-between; padding:0 12px; border-bottom:1px solid rgba(255,255,255,.12); }
.zd-ai-chat .prompts{ padding:10px; display:flex; flex-wrap:wrap; gap:8px; }
.zd-ai-chip{ padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.14); background:rgba(255,255,255,.08); cursor:pointer; }
.zd-ai-chat .msgs{ padding:12px; overflow:auto; }
.zd-ai-chat .msg{ padding:10px 12px; border-radius:12px; margin:6px 0; max-width:80%; box-shadow:0 6px 16px rgba(0,0,0,.25); white-space:pre-wrap; }
.zd-ai-chat .me{ background:rgba(255,255,255,.10); margin-left:auto; }
.zd-ai-chat .ai{ background:rgba(255,255,255,.06); }
.zd-ai-chat .input{ padding:10px; display:flex; gap:8px; border-top:1px solid rgba(255,255,255,.12); }
.zd-ai-chat input[type=text]{ flex:1; height:40px; border-radius:10px; border:1px solid rgba(255,255,255,.16); background:rgba(255,255,255,.08); color:#fff; padding:0 10px; font-weight:700; }
.zd-ai-chat button.send{ height:40px; padding:0 12px; border-radius:10px; border:1px solid rgba(255,255,255,.16); background:#fff; color:#111; font-weight:800; }

/* typewriter caret */
.zd-ai-typing{ border-right:2px solid rgba(255,255,255,.6); animation: zdai-caret 1s infinite; }
@keyframes zdai-caret{ 0%,100%{ border-color:transparent } 50%{ border-color:rgba(255,255,255,.6) } }

/* FAB AI góc phải (fallback) */
.zd-ai-fab{
  position:fixed; top:10px; right:12px; z-index:170; width:38px; height:38px; border-radius:10px;
  display:grid; place-items:center; cursor:pointer; border:1px solid rgba(255,255,255,.18);
  background:rgba(0,0,0,.28); backdrop-filter:blur(10px); box-shadow:0 8px 20px rgba(0,0,0,.35); transition:transform .12s ease;
}
.zd-ai-fab:hover{ transform:translateY(-1px); }
.zd-ai-fab img, .zd-ai-fab svg{ width:22px; height:22px; display:none; }
.zd-ai-fab.has-img img{ display:block; }
.zd-ai-fab:not(.has-img) svg{ display:block; }

/* ===== FIX: hiển thị icon theo class has-img (không bị rule khác đè) ===== */
#dock .task-btn img,
#dock .task-btn svg{ display:none !important; width:var(--dock-ico,36px); height:36px; object-fit:contain; }
#dock .task-btn.has-img img{ display:block !important; }
#dock .task-btn:not(.has-img) svg{ display:block !important; }

/* Cho click được ở giữa dock + indicator không delay */
.center-abs{ pointer-events:none; }
#taskCenter,.task-btn{ pointer-events:auto; }
.ind,.task-ind{ transition-delay:0s !important; animation-delay:0s !important; }

/* FAB AI góc phải (click = bật AI, RC = đổi icon, Shift+click = reset) */
.zd-ai-fab{
  position:fixed; top:10px; right:12px; z-index:170;
  width:38px; height:38px; border-radius:10px;
  display:grid; place-items:center; cursor:pointer;
  border:1px solid rgba(255,255,255,.18); background:rgba(0,0,0,.28);
  backdrop-filter: blur(10px);
  box-shadow: 0 8px 20px rgba(0,0,0,.35);
  transition: transform .12s ease;
}
.zd-ai-fab:hover{ transform: translateY(-1px); }
.zd-ai-fab img, .zd-ai-fab svg{ width:22px; height:22px; display:none; }
.zd-ai-fab.has-img img{ display:block; }
.zd-ai-fab:not(.has-img) svg{ display:block; }

/* AI overlay (neon ring + liquid) — giữ nguyên nếu bạn đã có; dưới là bản rút gọn */
.zd-ai-root{ position:fixed; inset:0; z-index:160; pointer-events:none; display:none; }
.zd-ai-root.on{ display:block; }
.zd-ai-ring{
  position:absolute; inset:0; border:4px solid transparent; border-radius:20px; padding:4px;
  background:conic-gradient(from 0deg,#ff7ad9,#76e0ff,#9dff7c,#ffda6b,#ff7ad9);
  -webkit-mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);
  mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);
  -webkit-mask-composite:xor; mask-composite:exclude; opacity:.9;
  animation: zdai-ring 7s linear infinite;
}
@keyframes zdai-ring{ to{ filter:hue-rotate(360deg) } }
.zd-ai-splash{ position:absolute; inset:0; filter:url(#zd-ai-goo); }
.zd-ai-blob{ position:absolute; left:50%; top:50%; width:200px; height:200px; border-radius:50%;
  background:radial-gradient(circle at 30% 30%,rgba(255,255,255,.75),rgba(255,255,255,.15));
  transform:translate(-50%,-50%) scale(.2); mix-blend-mode:screen; opacity:.85;
}
.zd-ai-root.on .zd-ai-blob{ animation: zdai-burst 680ms cubic-bezier(.2,.85,.15,1) both; }
.zd-ai-blob.b2{ animation-delay:40ms } .zd-ai-blob.b3{ animation-delay:80ms } .zd-ai-blob.b4{ animation-delay:120ms }
@keyframes zdai-burst{
  0%{ transform:translate(-50%,-50%) scale(.2); filter:blur(16px) }
  55%{ transform:translate(calc(-50% - 22vw),calc(-50% - 14vh)) scale(1.15); filter:blur(6px) }
  100%{ transform:translate(calc(-50% + 24vw),calc(-50% + 18vh)) scale(1); filter:blur(0) }
}
.zd-ai-pill{ position:fixed; left:50%; top:14px; transform:translateX(-50%); z-index:170; display:none; }
.zd-ai-pill.on{ display:block; }
.zd-ai-pill .pill{ display:flex; align-items:center; gap:10px; padding:8px 12px; border-radius:20px;
  border:1px solid rgba(255,255,255,.2); background:rgba(18,18,22,.65); color:#fff; backdrop-filter:blur(16px); }
.zd-ai-dot{ width:8px; height:8px; border-radius:50%; background:#5dffb5; box-shadow:0 0 10px #5dffb5; }

/* ===== AI 2.0 — liquid ring + glow, màu đồng bộ wallpaper ===== */
:root{
  --ai1:#ff7ad9; --ai2:#76e0ff; --ai3:#9dff7c; --ai4:#ffda6b; /* sẽ bị JS cập nhật theo wallpaper */
}
.zd2-ai-root{ position:fixed; inset:0; z-index:160; pointer-events:none; display:none; }
.zd2-ai-root.on{ display:block; }

/* Viền gradient chạy quanh màn hình + halo glow di chuyển */
.zd2-ai-ring{
  position:absolute; inset:0; border:5px solid transparent; border-radius:22px; padding:5px;
  background: conic-gradient(from 0deg, var(--ai1), var(--ai2), var(--ai3), var(--ai4), var(--ai1));
  -webkit-mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);
  mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);
  -webkit-mask-composite:xor; mask-composite:exclude;
  animation: ai2-rot 7s linear infinite;
}
@keyframes ai2-rot{ to{ filter:hue-rotate(360deg); } }

/* halo mờ phía sau viền (nhẹ nhàng chạy) */
.zd2-ai-glow{
  position:absolute; inset:-30px; border-radius:40px;
  background: conic-gradient(from 0deg, color-mix(in oklab, var(--ai1) 45%, transparent), color-mix(in oklab, var(--ai2) 45%, transparent), color-mix(in oklab, var(--ai3) 45%, transparent), color-mix(in oklab, var(--ai4) 45%, transparent), color-mix(in oklab, var(--ai1) 45%, transparent));
  filter: blur(36px) saturate(120%);
  opacity:.8; animation: ai2-glow 12s linear infinite;
}
@keyframes ai2-glow{ 0%{ transform:translateX(-2%) } 50%{ transform:translateX(2%) } 100%{ transform:translateX(-2%) } }

/* Liquid splash phóng to (metaballs) */
.zd2-ai-splash{ position:absolute; inset:0; filter:url(#zd2-ai-goo); pointer-events:none; }
.zd2-blob{
  position:absolute; width:240px; height:240px; border-radius:50%;
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.80), rgba(255,255,255,.18));
  mix-blend-mode:screen; opacity:.9; transform:translate(-50%,-50%) scale(.15);
}
.zd2-ai-root.on .zd2-blob{ animation: ai2-burst 780ms cubic-bezier(.2,.85,.15,1) both; }
.zd2-blob.b2{ animation-delay:60ms } .zd2-blob.b3{ animation-delay:120ms } .zd2-blob.b4{ animation-delay:180ms }
@keyframes ai2-burst{
  0%  { transform:translate(-50%,-50%) scale(.15); filter:blur(18px) }
  60% { transform:translate(calc(-50% - 24vw), calc(-50% - 16vh)) scale(1.18); filter:blur(6px) }
  100%{ transform:translate(calc(-50% + 26vw), calc(-50% + 18vh)) scale(1.00); filter:blur(0) }
}

/* Top pill */
.zd2-pill{ position:fixed; left:50%; top:12px; transform:translateX(-50%); z-index:170; display:none; }
.zd2-pill.on{ display:block; }
.zd2-pill .pill{
  display:flex; align-items:center; gap:10px; padding:8px 12px; border-radius:22px;
  border:1px solid rgba(255,255,255,.22); background:rgba(18,18,22,.62); color:#fff; backdrop-filter:blur(16px);
}
.zd2-dot{ width:8px; height:8px; border-radius:50%; background:#5dffb5; box-shadow:0 0 10px #5dffb5; }
.zd2-actions button{ border:0; background:transparent; color:#fff; font-size:16px; margin-left:6px; cursor:pointer; }

/* Chat popup */
.zd2-chat{ position:fixed; left:50%; top:50%; transform:translate(-50%,-50%) scale(.98);
  width:min(880px, calc(100vw - 40px)); height:min(600px, calc(100vh - 80px));
  border-radius:18px; border:1px solid rgba(255,255,255,.2);
  background:rgba(22,22,26,.62); color:#fff; backdrop-filter:blur(18px) saturate(140%);
  box-shadow:0 30px 80px rgba(0,0,0,.5), 0 2px 8px rgba(0,0,0,.25);
  display:none; z-index:180;
}
.zd2-chat.on{ display:grid; grid-template-rows:auto auto 1fr auto; animation: ai2-pop .18s cubic-bezier(.2,.85,.15,1) both; }
@keyframes ai2-pop{ from{ opacity:0; transform:translate(-50%,-50%) scale(.96) } to{ opacity:1; transform:translate(-50%,-50%) scale(1) } }
.zd2-chat .head{ height:48px; display:flex; align-items:center; justify-content:space-between; padding:0 12px; border-bottom:1px solid rgba(255,255,255,.12); }
.zd2-chat .prompts{ padding:10px; display:flex; flex-wrap:wrap; gap:8px; }
.zd2-chip{ padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.14); background:rgba(255,255,255,.1); cursor:pointer; }
.zd2-chat .msgs{ padding:12px; overflow:auto; }
.zd2-chat .msg{ padding:10px 12px; border-radius:12px; margin:6px 0; max-width:80%; box-shadow:0 6px 16px rgba(0,0,0,.25); white-space:pre-wrap; }
.zd2-chat .me{ background:rgba(255,255,255,.14); margin-left:auto; }
.zd2-chat .ai{ background:rgba(255,255,255,.08); }
.zd2-chat .input{ padding:10px; display:flex; gap:8px; border-top:1px solid rgba(255,255,255,.12); }
.zd2-chat input[type=text]{ flex:1; height:40px; border-radius:10px; border:1px solid rgba(255,255,255,.16); background:rgba(255,255,255,.1); color:#fff; padding:0 10px; font-weight:700; }
.zd2-chat button.send{ height:40px; padding:0 12px; border-radius:10px; border:1px solid rgba(255,255,255,.16); background:#fff; color:#111; font-weight:800; }

/* Typewriter từng chữ */
.zd2-caret{ border-right:2px solid rgba(255,255,255,.6); animation: zd2-blink 1s infinite; }
@keyframes zd2-blink{ 0%,100%{ border-color:transparent } 50%{ border-color:rgba(255,255,255,.6) } }

/* FAB AI góc phải (click = bật AI, RC = đổi icon, Shift = reset) */
.zd2-fab{
  position:fixed; top:10px; right:12px; z-index:175; width:38px; height:38px; border-radius:10px;
  display:grid; place-items:center; cursor:pointer; border:1px solid rgba(255,255,255,.18);
  background:rgba(0,0,0,.28); backdrop-filter:blur(10px); box-shadow:0 8px 20px rgba(0,0,0,.35);
}
.zd2-fab img,.zd2-fab svg{ width:22px; height:22px; display:none; }
.zd2-fab.has-img img{ display:block; }
.zd2-fab:not(.has-img) svg{ display:block; }

/* RC change icon — show by class has-img (chặn rule khác) */
#dock .task-btn img,#dock .task-btn svg{ display:none !important; width:36px; height:36px; object-fit:contain; }
#dock .task-btn.has-img img{ display:block !important; }
#dock .task-btn:not(.has-img) svg{ display:block !important; }

/* Cho phép RC icon giữa dock */
.center-abs{ pointer-events:none; } #taskCenter,.task-btn{ pointer-events:auto; }
.ind,.task-ind{ transition-delay:0s !important; animation-delay:0s !important; }

/* ===== AI 3.0 — liquid ring + halo, sync màu theo wallpaper ===== */
:root{ --ai-c1:#ff7ad9; --ai-c2:#76e0ff; --ai-c3:#9dff7c; --ai-c4:#ffda6b; }
.ai3-root{ position:fixed; inset:0; z-index:160; pointer-events:none; display:none; }
.ai3-root.on{ display:block; }

/* Ring gradient + halo glow */
.ai3-ring{
  position:absolute; inset:0; border:6px solid transparent; border-radius:24px; padding:6px;
  background: conic-gradient(from var(--ai-angle,0deg), var(--ai-c1), var(--ai-c2), var(--ai-c3), var(--ai-c4), var(--ai-c1));
  -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite: xor; mask-composite: exclude;
  transform: scale(var(--ai-scale,.98));
  opacity:.95; animation: ai3-rot 8s linear infinite;
}
@keyframes ai3-rot{ to{ filter:hue-rotate(360deg); } }

.ai3-glow{
  position:absolute; inset:-38px; border-radius:40px;
  background: conic-gradient(from var(--ai-angle,0deg),
    color-mix(in oklab, var(--ai-c1) 40%, transparent),
    color-mix(in oklab, var(--ai-c2) 40%, transparent),
    color-mix(in oklab, var(--ai-c3) 40%, transparent),
    color-mix(in oklab, var(--ai-c4) 40%, transparent),
    color-mix(in oklab, var(--ai-c1) 40%, transparent));
  filter: blur(48px) saturate(120%); opacity:.8; animation: ai3-glow 14s ease-in-out infinite;
}
@keyframes ai3-glow{ 0%,100%{ transform:translateX(-1.8%) } 50%{ transform:translateX(1.8%) } }

/* Liquid metaballs */
.ai3-liquid{ position:absolute; inset:0; filter:url(#ai3-goo); pointer-events:none; }
.ai3-b{ position:absolute; width:240px; height:240px; border-radius:50%;
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.80), rgba(255,255,255,.18));
  mix-blend-mode: screen; opacity:.9; transform: translate(-50%,-50%) scale(.15);
}
.ai3-root.on .ai3-b{ animation: ai3-burst 780ms cubic-bezier(.2,.85,.15,1) both; }
.ai3-b.b2{ animation-delay:60ms } .ai3-b.b3{ animation-delay:120ms } .ai3-b.b4{ animation-delay:180ms }
@keyframes ai3-burst{
  0%  { transform:translate(-50%,-50%) scale(.15); filter:blur(16px) }
  55% { transform:translate(calc(-50% - 24vw), calc(-50% - 14vh)) scale(1.15); filter:blur(6px) }
  100%{ transform:translate(calc(-50% + 26vw), calc(-50% + 18vh)) scale(1.0); filter:blur(0) }
}

/* Pill trên top */
.ai3-pill{ position:fixed; left:50%; top:14px; transform:translateX(-50%); z-index:170; display:none; }
.ai3-pill.on{ display:block; }
.ai3-pill .pill{
  display:flex; align-items:center; gap:10px; padding:8px 12px; border-radius:20px;
  border:1px solid rgba(255,255,255,.22); background:rgba(18,18,22,.65); color:#fff; backdrop-filter:blur(16px);
}
.ai3-dot{ width:8px; height:8px; border-radius:50%; background:#5dffb5; box-shadow:0 0 10px #5dffb5; }
.ai3-actions button{ border:0; background:transparent; color:#fff; font-size:16px; margin-left:6px; cursor:pointer; }

/* Chat popup (mở khi bấm icon bàn phím) */
.ai3-chat{ position:fixed; left:50%; top:50%; transform:translate(-50%,-50%) scale(.98);
  width:min(880px, calc(100vw - 40px)); height:min(600px, calc(100vh - 80px));
  border-radius:18px; border:1px solid rgba(255,255,255,.2);
  background:rgba(22,22,26,.62); color:#fff; backdrop-filter:blur(18px) saturate(140%);
  box-shadow:0 30px 80px rgba(0,0,0,.5), 0 2px 8px rgba(0,0,0,.25);
  display:none; z-index:180;
}
.ai3-chat.on{ display:grid; grid-template-rows:auto auto 1fr auto; animation: ai3-pop .18s cubic-bezier(.2,.85,.15,1) both; }
@keyframes ai3-pop{ from{ opacity:0; transform:translate(-50%,-50%) scale(.96) } to{ opacity:1; transform:translate(-50%,-50%) scale(1) } }
.ai3-chat .head{ height:48px; display:flex; align-items:center; justify-content:space-between; padding:0 12px; border-bottom:1px solid rgba(255,255,255,.12); }
.ai3-chat .prompts{ padding:10px; display:flex; flex-wrap:wrap; gap:8px; }
.ai3-chip{ padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.14); background:rgba(255,255,255,.1); cursor:pointer; }
.ai3-chat .msgs{ padding:12px; overflow:auto; }
.ai3-chat .msg{ padding:10px 12px; border-radius:12px; margin:6px 0; max-width:80%; box-shadow:0 6px 16px rgba(0,0,0,.25); white-space:pre-wrap; }
.ai3-chat .me{ background:rgba(255,255,255,.14); margin-left:auto; }
.ai3-chat .ai{ background:rgba(255,255,255,.08); }
.ai3-chat .input{ padding:10px; display:flex; gap:8px; border-top:1px solid rgba(255,255,255,.12); }
.ai3-chat input[type=text]{ flex:1; height:40px; border-radius:10px; border:1px solid rgba(255,255,255,.16); background:rgba(255,255,255,.1); color:#fff; padding:0 10px; font-weight:700; }
.ai3-chat button.send{ height:40px; padding:0 12px; border-radius:10px; border:1px solid rgba(255,255,255,.16); background:#fff; color:#111; font-weight:800; }

/* Typewriter từng chữ */
.ai3-caret{ border-right:2px solid rgba(255,255,255,.6); animation: ai3-blink 1s infinite; }
@keyframes ai3-blink{ 0%,100%{ border-color:transparent } 50%{ border-color:rgba(255,255,255,.6) } }

/* Nút AI góc phải (fallback mở AI, RC để đổi icon) */
.ai3-fab{
  position:fixed; top:10px; right:12px; z-index:175; width:38px; height:38px; border-radius:10px;
  display:grid; place-items:center; cursor:pointer; border:1px solid rgba(255,255,255,.18);
  background:rgba(0,0,0,.28); backdrop-filter:blur(10px); box-shadow:0 8px 20px rgba(0,0,0,.35);
}
.ai3-fab img,.ai3-fab svg{ width:22px; height:22px; display:none; }
.ai3-fab.has-img img{ display:block; }
.ai3-fab:not(.has-img) svg{ display:block; }

/* RC-Icon hiển thị theo class has-img để không bị rule khác đè */
#dock .task-btn img,#dock .task-btn svg{ display:none !important; width:36px; height:36px; object-fit:contain; }
#dock .task-btn.has-img img{ display:block !important; }
#dock .task-btn:not(.has-img) svg{ display:block !important; }
.center-abs{ pointer-events:none; } #taskCenter,.task-btn{ pointer-events:auto; }
.ind,.task-ind{ transition-delay:0s !important; animation-delay:0s !important; }

/* ==== AI 4.0 — Ink splash (no ring), bar animated, chat ==== */
:root{ --aiA:#7ad1ff; --aiB:#ff7ad9; }

/* Ẩn mọi overlay AI cũ (nếu còn) */
.zd-ai-root,.zd2-ai-root,.ai3-root{ display:none !important; }

/* Overlay mới */
.ai4-root{ position:fixed; inset:0; z-index:160; pointer-events:none; display:none; }
.ai4-root.on{ display:block; }

/* Ink splash: radial gradient mở rộng rồi biến mất */
.ai4-ink{
  position:absolute; left:50%; top:50%;
  width:120vmax; height:120vmax; transform:translate(-50%,-50%) scale(.2);
  border-radius:50%;
  background: radial-gradient(circle at 50% 50%,
    color-mix(in oklab, var(--aiA) 65%, rgba(255,255,255,.85)) 0%,
    color-mix(in oklab, var(--aiB) 45%, transparent) 60%,
    transparent 72%);
  filter: blur(22px) saturate(120%);
  opacity:.0;
}
.ai4-root.on .ai4-ink{ animation: ai4-ink 600ms cubic-bezier(.2,.85,.15,1) both; }
@keyframes ai4-ink{
  0%   { transform:translate(-50%,-50%) scale(.25); opacity:.00; filter:blur(26px) saturate(120%); }
  55%  { transform:translate(-50%,-50%) scale(1.06); opacity:.85; filter:blur(16px) saturate(115%); }
  100% { transform:translate(-50%,-50%) scale(1.25); opacity:.00; filter:blur(26px) saturate(120%); }
}

/* Top bar (AI pill) + animation */
.ai4-pill{ position:fixed; left:50%; top:14px; transform:translateX(-50%); z-index:170; display:none; }
.ai4-pill.on{ display:block; animation: ai4-pill-in 180ms cubic-bezier(.2,.85,.15,1); }
@keyframes ai4-pill-in{ from{ opacity:0; transform:translateX(-50%) translateY(-6px) scale(.98) } to{ opacity:1; transform:translateX(-50%) translateY(0) scale(1) } }
.ai4-pill .pill{
  display:flex; align-items:center; gap:10px; padding:8px 12px; border-radius:22px;
  border:1px solid rgba(255,255,255,.22); background:rgba(18,18,22,.65); color:#fff; backdrop-filter:blur(16px);
}
.ai4-dot{ width:8px; height:8px; border-radius:50%; background:#5dffb5; box-shadow:0 0 10px #5dffb5; }

/* Meter chạy nhẹ dưới chữ Listening */
.ai4-meter{
  position:absolute; left:8px; right:8px; bottom:6px; height:3px; border-radius:99px; overflow:hidden; opacity:.55;
}
.ai4-meter::before{
  content:""; position:absolute; inset:0;
  background: linear-gradient(90deg, transparent, var(--aiA), var(--aiB), transparent);
  animation: ai4-meter 2.1s linear infinite;
}
@keyframes ai4-meter{
  0%{ transform:translateX(-100%) } 100%{ transform:translateX(100%) }
}
.ai4-actions button{ border:0; background:transparent; color:#fff; font-size:16px; margin-left:6px; cursor:pointer; }

/* Chat popup (nhấn icon bàn phím) */
.ai4-chat{
  position:fixed; left:50%; top:50%; transform:translate(-50%,-50%) scale(.98);
  width:min(880px, calc(100vw - 40px)); height:min(600px, calc(100vh - 80px));
  border-radius:18px; border:1px solid rgba(255,255,255,.2);
  background:rgba(22,22,26,.62); color:#fff; backdrop-filter:blur(18px) saturate(140%);
  box-shadow:0 30px 80px rgba(0,0,0,.5), 0 2px 8px rgba(0,0,0,.25);
  display:none; z-index:180;
}
.ai4-chat.on{ display:grid; grid-template-rows:auto auto 1fr auto; animation: ai4-chat-in 180ms cubic-bezier(.2,.85,.15,1); }
@keyframes ai4-chat-in{ from{ opacity:0; transform:translate(-50%,-50%) scale(.96) } to{ opacity:1; transform:translate(-50%,-50%) scale(1) } }
.ai4-chat .head{ height:48px; display:flex; align-items:center; justify-content:space-between; padding:0 12px; border-bottom:1px solid rgba(255,255,255,.12); }
.ai4-chat .prompts{ padding:10px; display:flex; flex-wrap:wrap; gap:8px; }
.ai4-chip{ padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.14); background:rgba(255,255,255,.1); cursor:pointer; }
.ai4-chat .msgs{ padding:12px; overflow:auto; }
.ai4-chat .msg{ padding:10px 12px; border-radius:12px; margin:6px 0; max-width:80%; box-shadow:0 6px 16px rgba(0,0,0,.25); white-space:pre-wrap; }
.ai4-chat .me{ background:rgba(255,255,255,.14); margin-left:auto; }
.ai4-chat .ai{ background:rgba(255,255,255,.08); }
.ai4-chat .input{ padding:10px; display:flex; gap:8px; border-top:1px solid rgba(255,255,255,.12); }
.ai4-chat input[type=text]{ flex:1; height:40px; border-radius:10px; border:1px solid rgba(255,255,255,.16); background:rgba(255,255,255,.1); color:#fff; padding:0 10px; font-weight:700; }
.ai4-chat button.send{ height:40px; padding:0 12px; border-radius:10px; border:1px solid rgba(255,255,255,.16); background:#fff; color:#111; font-weight:800; }

/* typewriter từng chữ */
.ai4-caret{ border-right:2px solid rgba(255,255,255,.6); animation: ai4-blink 1s infinite; }
@keyframes ai4-blink{ 0%,100%{ border-color:transparent } 50%{ border-color:rgba(255,255,255,.6) } }

/* FAB AI (góc phải) + RC icon */
.ai4-fab{ position:fixed; top:10px; right:12px; z-index:175; width:38px; height:38px; border-radius:10px;
  display:grid; place-items:center; cursor:pointer; border:1px solid rgba(255,255,255,.18);
  background:rgba(0,0,0,.28); backdrop-filter:blur(10px); box-shadow:0 8px 20px rgba(0,0,0,.35); }
.ai4-fab img,.ai4-fab svg{ width:22px; height:22px; display:none; }
.ai4-fab.has-img img{ display:block; } .ai4-fab:not(.has-img) svg{ display:block; }

/* RC icon hiển thị theo class has-img (khóa xung đột) */
#dock .task-btn img,#dock .task-btn svg{ display:none !important; width:36px; height:36px; object-fit:contain; }
#dock .task-btn.has-img img{ display:block !important; }
#dock .task-btn:not(.has-img) svg{ display:block !important; }
.center-abs{ pointer-events:none; } #taskCenter,.task-btn{ pointer-events:auto; }
.ind,.task-ind{ transition-delay:0s !important; animation-delay:0s !important; }

/* ==== AI 4.1 — ink burst mượt + pill đẹp ==== */
:root{ --aiA:#7ad1ff; --aiB:#ff7ad9; }

/* overlay */
.ai4-root{ position:fixed; inset:0; z-index:160; pointer-events:none; display:none; }
.ai4-root.on{ display:block; }

/* 3 lớp ink để mượt (nổ ra → tan dần) */
.ai4-ink, .ai4-ink-b, .ai4-ink-c{
  position:absolute; left:50%; top:50%; border-radius:50%;
  width:120vmax; height:120vmax; transform:translate(-50%,-50%) scale(.2);
  filter: blur(24px) saturate(120%); opacity:0; will-change: transform, opacity, filter;
}
.ai4-ink   { background: radial-gradient(circle, color-mix(in oklab, var(--aiA) 70%, #fff) 0%, transparent 70%); }
.ai4-ink-b { background: radial-gradient(circle, color-mix(in oklab, var(--aiB) 55%, #fff) 0%, transparent 72%); }
.ai4-ink-c { background: radial-gradient(circle, color-mix(in oklab, var(--aiA) 40%, transparent) 0%, transparent 74%); }

.ai4-root.on .ai4-ink   { animation: ai4-burst-1 760ms cubic-bezier(.2,.85,.15,1) both; }
.ai4-root.on .ai4-ink-b { animation: ai4-burst-2 820ms cubic-bezier(.2,.85,.15,1) .04s both; }
.ai4-root.on .ai4-ink-c { animation: ai4-burst-3 900ms cubic-bezier(.2,.85,.15,1) .08s both; }

@keyframes ai4-burst-1{
  0%{   transform:translate(-50%,-50%) scale(.25); opacity:.0;  filter:blur(28px) }
  55%{  transform:translate(-50%,-50%) scale(1.08); opacity:.85; filter:blur(16px) }
  100%{ transform:translate(-50%,-50%) scale(1.28); opacity:0;  filter:blur(28px) }
}
@keyframes ai4-burst-2{
  0%{   transform:translate(-50%,-50%) scale(.22); opacity:.0;  filter:blur(30px) }
  58%{  transform:translate(-50%,-50%) scale(1.02); opacity:.75; filter:blur(18px) }
  100%{ transform:translate(-50%,-50%) scale(1.24); opacity:0;  filter:blur(30px) }
}
@keyframes ai4-burst-3{
  0%{   transform:translate(-50%,-50%) scale(.20); opacity:.0;  filter:blur(30px) }
  60%{  transform:translate(-50%,-50%) scale(.98);  opacity:.65; filter:blur(20px) }
  100%{ transform:translate(-50%,-50%) scale(1.20); opacity:0;  filter:blur(30px) }
}

/* Pill đẹp + streak + dots thở */
.ai4-pill{ position:fixed; left:50%; top:14px; transform:translateX(-50%); z-index:170; display:none; }
.ai4-pill.on{ display:block; animation: ai4-pill-in 180ms cubic-bezier(.2,.85,.15,1); }
@keyframes ai4-pill-in{ from{ opacity:0; transform:translateX(-50%) translateY(-6px) scale(.98) } to{ opacity:1; transform:translateX(-50%) translateY(0) scale(1) } }

.ai4-pill .pill{
  position:relative; display:flex; align-items:center; gap:10px;
  padding:8px 14px; border-radius:999px;
  border:1px solid rgba(255,255,255,.22);
  background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
  color:#fff; backdrop-filter: blur(16px) saturate(140%);
  box-shadow: 0 10px 30px rgba(0,0,0,.35);
}
.ai4-dot{ width:8px; height:8px; border-radius:50%; background:#5dffb5; box-shadow:0 0 10px #5dffb5; animation: ai4-breathe 2.6s ease-in-out infinite; }
@keyframes ai4-breathe{ 0%,100%{ transform:scale(1) } 50%{ transform:scale(1.15) } }

/* gradient streak chạy dưới chữ */
.ai4-meter{
  position:absolute; left:8px; right:8px; bottom:6px; height:3px; border-radius:99px; overflow:hidden; opacity:.55;
}
.ai4-meter::before{
  content:""; position:absolute; inset:0;
  background: linear-gradient(90deg, transparent, var(--aiA), var(--aiB), transparent);
  animation: ai4-meter 2.2s linear infinite;
}
@keyframes ai4-meter{ 0%{ transform:translateX(-100%) } 100%{ transform:translateX(100%) } }

.ai4-actions button{ border:0; background:transparent; color:#fff; font-size:16px; margin-left:6px; cursor:pointer; }

/* Chat popup (giữ như cũ) */
.ai4-chat{ position:fixed; left:50%; top:50%; transform:translate(-50%,-50%) scale(.98);
  width:min(880px, calc(100vw - 40px)); height:min(600px, calc(100vh - 80px));
  border-radius:18px; border:1px solid rgba(255,255,255,.2);
  background:rgba(22,22,26,.62); color:#fff; backdrop-filter:blur(18px) saturate(140%);
  box-shadow:0 30px 80px rgba(0,0,0,.5), 0 2px 8px rgba(0,0,0,.25);
  display:none; z-index:180; 
}
.ai4-chat.on{ display:grid; grid-template-rows:auto auto 1fr auto; animation: ai4-chat-in 180ms cubic-bezier(.2,.85,.15,1); }
@keyframes ai4-chat-in{ from{ opacity:0; transform:translate(-50%,-50%) scale(.96) } to{ opacity:1; transform:translate(-50%,-50%) scale(1) } }
.ai4-chat .head{ height:48px; display:flex; align-items:center; justify-content:space-between; padding:0 12px; border-bottom:1px solid rgba(255,255,255,.12); }
.ai4-chat .prompts{ padding:10px; display:flex; flex-wrap:wrap; gap:8px; }
.ai4-chip{ padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.14); background:rgba(255,255,255,.1); cursor:pointer; }
.ai4-chat .msgs{ padding:12px; overflow:auto; }
.ai4-chat .msg{ padding:10px 12px; border-radius:12px; margin:6px 0; max-width:80%; box-shadow:0 6px 16px rgba(0,0,0,.25); white-space:pre-wrap; }
.ai4-chat .me{ background:rgba(255,255,255,.14); margin-left:auto; }
.ai4-chat .ai{ background:rgba(255,255,255,.08); }
.ai4-chat .input{ padding:10px; display:flex; gap:8px; border-top:1px solid rgba(255,255,255,.12); }
.ai4-chat input[type=text]{ flex:1; height:40px; border-radius:10px; border:1px solid rgba(255,255,255,.16); background:rgba(255,255,255,.1); color:#fff; padding:0 10px; font-weight:700; }
.ai4-chat button.send{ height:40px; padding:0 12px; border-radius:10px; border:1px solid rgba(255,255,255,.16); background:#fff; color:#111; font-weight:800; }

/* typewriter từng chữ */
.ai4-caret{ border-right:2px solid rgba(255,255,255,.6); animation: ai4-blink 1s infinite; }
@keyframes ai4-blink{ 0%,100%{ border-color:transparent } 50%{ border-color:rgba(255,255,255,.6) } }

/* FAB AI góc phải + RC icon */
.ai4-fab{ position:fixed; top:10px; right:12px; z-index:175; width:38px; height:38px; border-radius:10px;
  display:grid; place-items:center; cursor:pointer; border:1px solid rgba(255,255,255,.18);
  background:rgba(0,0,0,.28); backdrop-filter:blur(10px); box-shadow:0 8px 20px rgba(0,0,0,.35); }
.ai4-fab img,.ai4-fab svg{ width:22px; height:22px; display:none; }
.ai4-fab.has-img img{ display:block; } .ai4-fab:not(.has-img) svg{ display:block; }

/* Dock icon hiển thị theo class has-img (khóa xung đột) */
#dock .task-btn img,#dock .task-btn svg{ display:none !important; width:36px; height:36px; object-fit:contain; }
#dock .task-btn.has-img img{ display:block !important; }
#dock .task-btn:not(.has-img) svg{ display:block !important; }
.center-abs{ pointer-events:none; } #taskCenter,.task-btn{ pointer-events:auto; }
.ind,.task-ind{ transition-delay:0s !important; animation-delay:0s !important; }

/* AI typing: từng dòng mờ -> rõ dần */
.ai4-line{
  opacity:.05;
  filter: blur(4px);
  transform: translateY(4px);
  transition: opacity .35s ease, filter .35s ease, transform .35s ease;
  will-change: opacity, filter, transform;
}
.ai4-line.on{
  opacity:1;
  filter: blur(0);
  transform: translateY(0);
}

/* RC icon: hiển thị theo class has-img (khóa mọi rule cũ) */
.task-btn img, .logo img, .qt img { 
  display:none !important; 
  width:var(--dock-ico,36px); height:36px; object-fit:contain; 
}
.task-btn.has-img img, .logo.has-img img, .qt.has-img img { display:block !important; }
.task-btn.has-img svg,  .logo.has-img svg,  .qt.has-img svg  { display:none !important; }

/* Cho phép click/RC vào icon giữa dock */
.center-abs{ pointer-events:none; }
#taskCenter, .task-btn, .logo, .qt{ pointer-events:auto; }

/* Hiển thị icon IMG khi wrapper có has-img */
.task-btn img, .logo img, .qt img { 
  display:none !important; 
  width:36px; height:36px; object-fit:contain;
}
.task-btn.has-img img, .logo.has-img img, .qt.has-img img { display:block !important; }
.task-btn.has-img svg,  .logo.has-img svg,  .qt.has-img svg  { display:none !important; }

/* Cho phép click vào icon giữa dock */
.center-abs{ pointer-events:none; }
#taskCenter, .task-btn, .logo, .qt{ pointer-events:auto; }

/* Hiển thị IMG khi có has-img, ngược lại dùng SVG */
.task-btn img, .logo img, .qt img{
  display:none !important;
  width:36px; height:36px; object-fit:contain;
}
.task-btn.has-img img, .logo.has-img img, .qt.has-img img{ display:block !important; }
.task-btn.has-img svg,  .logo.has-img svg,  .qt.has-img svg { display:none !important; }

/* Cho phép click/drag ở giữa dock */
.center-abs{ pointer-events:none; }
#taskCenter, .task-btn, .logo, .qt{ pointer-events:auto; }
/* Kill all drop‑shadows (box-shadow + filter: drop-shadow) */
.window,
.dock,
.logo,
.task-btn,
.qt,
.widget,
.ctxmenu,
.widget-picker,
.ai4-chat,
.ai4-pill .pill,
.ai4-fab,
.spotify-frame,
.sidebar,
.card,
.search,
.spec-chip,
.w-bars .bar,
.spotify-toolbar,
.widget .w-head,
.widget .w-body,
.widget .resize {
  box-shadow: none !important;
  filter: none !important;   /* nếu phần tử dùng filter: drop-shadow */
}

/* SVG/icon: tắt drop-shadow/filter */
.task-btn svg,
.logo svg,
.qt svg,
.dock-spotify-ico,
.ico {
  filter: none !important;
}

/* (tùy chọn) tắt text-shadow ở đồng hồ/topbar nếu bạn muốn phẳng hoàn toàn */
.topbar,
.topbar .left,
#time { text-shadow: none !important; }

/* ===== 3D engine (macOS-like) ===== */
.desktop{ perspective: 1400px; perspective-origin: 50% 40%; }
.window{
  transform-style: preserve-3d;
  backface-visibility: hidden;
  will-change: transform, opacity, filter;
  /* không cần shadow; bạn đã tắt ở patch trước */
}

/* Tilt khi hover (nhẹ kiểu macOS) */
.window.tilt-on:hover{ transition: transform .12s ease-out; }
@media (prefers-reduced-motion: reduce){
  .desktop{ perspective: none; }
  .window{ transition: none !important; }
}

/* Kill every shadow (UI + icon + pseudo) */
.window,
.dock,
.task-btn,
.logo,
.qt,
.widget,
.ctxmenu,
.widget-picker,
.ai4-fab,           /* nút AI góc phải */
.ai4-pill .pill,
.ai4-chat,
.spotify-frame,
.sidebar,
.card,
.search,
.spec-chip,
.spotify-toolbar,
.widget .w-head,
.widget .w-body,
.widget .resize {
  box-shadow: none !important;
}

/* Tắt drop-shadow/blur trên SVG/icon và nút AI */
.task-btn svg,
.logo svg,
.qt svg,
.ai4-fab svg,
.dock-spotify-ico,
.ico {
  filter: none !important;
}

/* Nếu có pseudo tạo bóng */
*, *::before, *::after {
  /* chỉ remove shadow; không đụng blur/backdrop của glass */
  box-shadow: none !important;
}

/* Cho phép click icon giữa dock */
.center-abs{ pointer-events:none; }
#taskCenter, .task-btn, .logo, .qt, .ai4-fab{ pointer-events:auto; }

/* Hiển thị IMG khi wrapper có has-img */
.logo img{ display:none !important; width:36px; height:36px; object-fit:contain; }
.logo.has-img img{ display:block !important; }
.logo.has-img svg{ display:none !important; }

/* Live wallpaper video */
.wp-video{
  position:absolute; inset:0; width:100%; height:100%;
  object-fit:cover; pointer-events:none; display:none; z-index:0;
  transform: translate3d(0,0,0) scale(1.06);
}
.wp-video.on{ display:block; }

.win-controls{ pointer-events:auto; }
.win-controls .ctrl{ pointer-events:auto; }
/* Nút Add live wallpaper (không drop shadow) */
.live-fab{
  position: fixed; top: 58px; right: 12px; z-index: 176;
  width: 38px; height: 38px; border-radius: 10px;
  display: grid; place-items: center; cursor: pointer;
  border: 1px solid rgba(255,255,255,.18);
  background: rgba(0,0,0,.28); color: #fff;
  backdrop-filter: blur(10px);
  box-shadow: none !important;
}
.live-fab svg{ width: 20px; height: 20px; filter: none !important; }

/* Hàng ngang cho các FAB (AI + Live) */
.fab-row{
  position: fixed;
  top: 10px;               /* cao ngang với nút AI cũ */
  right: 12px;
  display: flex;
  gap: 10px;               /* khoảng cách giữa hai nút */
  z-index: 176;
  pointer-events: none;    /* không chặn click của phần tử con */
}

/* Khi nằm trong .fab-row thì bỏ vị trí fixed riêng lẻ */
.fab-row .ai4-fab,
.fab-row .live-fab{
  position: static !important;
  top: auto !important;
  right: auto !important;
  pointer-events: auto;    /* bật lại bắt sự kiện */
}

/* ===== Dock Player (taskbar music control) ===== */
.dock-player{
  display:none; align-items:center; gap:10px;
  height:48px; padding:6px 10px; margin:0 10px;
  border:1px solid rgba(255,255,255,.16);
  background: rgba(0,0,0,.26);
  backdrop-filter: blur(10px) saturate(140%);
  border-radius:12px; box-shadow:none; color:#fff;
}
.dock-player.on{ display:flex; }

.dock-player .cover{
  width:34px; height:34px; border-radius:6px; flex:0 0 34px;
  background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
  border:1px solid rgba(255,255,255,.18);
  overflow:hidden; display:grid; place-items:center;
}
.dock-player .cover img{ width:100%; height:100%; object-fit:cover; display:block; }

.dock-player .meta{ min-width:140px; max-width:220px; line-height:1.1; }
.dock-player .meta .title{ font-weight:800; font-size:13px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.dock-player .meta .artist{ opacity:.8; font-size:11px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

.dock-player .ctrls{ display:flex; align-items:center; gap:10px; }
.dock-player .btn{
  width:26px; height:26px; border:0; background:transparent;
  display:grid; place-items:center; border-radius:6px; cursor:pointer;
}
.dock-player .btn:hover{ background:rgba(255,255,255,.10); }
.dock-player .btn img{ width:18px; height:18px; display:block; filter:none !important; }
.dock-player .sep{ width:1px; height:26px; background:rgba(255,255,255,.16); border-radius:1px; opacity:.9; }

/* ===== Taskbar Player (nằm trong dock, trước .right) ===== */
.dock-player{
  display:none; align-items:center; gap:10px;
  height:48px; padding:6px 10px; margin:0 10px;
  border:1px solid rgba(255,255,255,.16);
  background:rgba(0,0,0,.26);
  backdrop-filter: blur(10px) saturate(140%);
  border-radius:12px; color:#fff;
  box-shadow:none !important;
}
.dock-player.on{ display:flex; }
.dock-player .cover{
  width:34px; height:34px; border-radius:6px; overflow:hidden;
  border:1px solid rgba(255,255,255,.16);
  background:linear-gradient(180deg, rgba(255,255,255,.1), rgba(255,255,255,.05));
  display:grid; place-items:center; flex:0 0 34px;
}
.dock-player .cover img{ width:100%; height:100%; display:block; object-fit:cover; }
.dock-player .meta{ min-width:140px; max-width:220px; line-height:1.15; }
.dock-player .meta .title{ font-weight:800; font-size:13px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.dock-player .meta .artist{ font-size:11px; opacity:.8; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.dock-player .ctrls{ display:flex; align-items:center; gap:10px; }
.dock-player .btn{ width:26px; height:26px; border:0; background:transparent; border-radius:6px; display:grid; place-items:center; cursor:pointer; }
.dock-player .btn:hover{ background:rgba(255,255,255,.1); }
.dock-player .btn img{ width:18px; height:18px; display:block; filter:none !important; }
.dock-player .sep{ width:1px; height:26px; background:rgba(255,255,255,.16); border-radius:1px; opacity:.9; }

/* ===== Dock Player (nếu bạn chưa có) ===== */
.dock-player{
  display:none; align-items:center; gap:10px;
  height:48px; padding:6px 10px; margin:0 10px;
  border:1px solid rgba(255,255,255,.16);
  background:rgba(0,0,0,.26);
  backdrop-filter: blur(10px) saturate(140%);
  border-radius:12px; color:#fff; box-shadow:none !important;
}
.dock-player.on{ display:flex; }
.dock-player .cover{ width:34px; height:34px; border-radius:6px; overflow:hidden;
  border:1px solid rgba(255,255,255,.16); background:rgba(255,255,255,.06);
  display:grid; place-items:center; flex:0 0 34px; }
.dock-player .cover img{ width:100%; height:100%; object-fit:cover; display:block; }
.dock-player .meta{ min-width:160px; max-width:240px; line-height:1.15; }
.dock-player .meta .title{ font-weight:800; font-size:13px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.dock-player .meta .artist{ font-size:11px; opacity:.8; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.dock-player .ctrls{ display:flex; align-items:center; gap:10px; }
.dock-player .btn{ width:26px; height:26px; border:0; background:transparent; border-radius:6px; display:grid; place-items:center; cursor:pointer; }
.dock-player .btn:hover{ background:rgba(255,255,255,.1); }
.dock-player .btn img{ width:18px; height:18px; display:block; filter:none !important; }
.dock-player .sep{ width:1px; height:26px; background:rgba(255,255,255,.16); border-radius:1px; opacity:.9; }

/* ===== Music Picker modal (nút riêng, không đụng ctxmenu) ===== */
.music-overlay{ position:fixed; inset:0; background:rgba(0,0,0,.25); backdrop-filter:blur(2px); z-index:300; display:none; }
.music-overlay.on{ display:block; }
.music-modal{
  position:fixed; left:50%; top:50%; transform:translate(-50%,-50%) scale(.98);
  width:min(780px, calc(100vw - 40px)); max-height:min(70vh, 560px);
  background:rgba(22,22,26,.62); color:#fff; border:1px solid rgba(255,255,255,.18);
  border-radius:16px; backdrop-filter:blur(18px) saturate(140%);
  box-shadow:none; z-index:301; display:none;
}
.music-modal.on{ display:grid; grid-template-rows:auto 1fr auto; animation: mp-pop .18s cubic-bezier(.2,.85,.15,1); }
@keyframes mp-pop{ from{ opacity:0; transform:translate(-50%,-50%) scale(.96) } to{ opacity:1; transform:translate(-50%,-50%) scale(1) } }
.music-head{ height:48px; display:flex; align-items:center; justify-content:space-between; padding:0 12px; border-bottom:1px solid rgba(255,255,255,.14); font-weight:800; }
.music-list{ padding:10px; overflow:auto; display:grid; gap:8px; }
.track{ display:flex; align-items:center; gap:10px; padding:8px 10px; border-radius:10px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.06); cursor:pointer; }
.track:hover{ background:rgba(255,255,255,.12); }
.track .name{ font-weight:800; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; }
.track .meta{ font-size:12px; opacity:.8; }

/* Nút mở Music Picker ở góc phải (xếp chung hàng với AI/live nếu bạn có) */
.fab-row{ position:fixed; top:10px; right:12px; display:flex; gap:10px; z-index:176; pointer-events:none; }
.fab-row > *{ position:static !important; pointer-events:auto; }
.music-fab{
  width:38px; height:38px; border-radius:10px; display:grid; place-items:center; cursor:pointer;
  border:1px solid rgba(255,255,255,.18); background:rgba(0,0,0,.28); color:#fff; backdrop-filter: blur(10px); box-shadow:none !important;
}
.music-fab svg{ width:20px; height:20px; }

/* ZimVer window */
.window.ver{
  position:absolute;
  left:50%; top:18%;
  transform:translateX(-50%);
  width:720px; max-width:calc(100vw - 40px);
  height:420px; max-height:calc(100vh - 80px);
  border:1px solid rgba(255,255,255,.18);
  background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
  color:#dfe6ee;
  backdrop-filter:blur(14px) saturate(140%);
  -webkit-backdrop-filter:blur(14px) saturate(140%);
  border-radius:16px; overflow:hidden; z-index:120;
}
.window.ver .titlebar{
  height:46px; display:flex; align-items:center; justify-content:space-between;
  padding:0 12px; border-bottom:1px solid rgba(255,255,255,.14);
  background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,0));
}
.ver-body{
  padding:14px; height:calc(100% - 46px);
  overflow:auto; white-space:pre-wrap;
  font:13px/1.5 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
}

/* Glow toàn màn hình khi AI mở */
.ai-glow{
  position:fixed; inset:0; pointer-events:none; z-index:140; display:none;
}
.ai-glow.on{ display:block; animation: aiGlowIn .22s ease-out both; }
@keyframes aiGlowIn{ from{opacity:0} to{opacity:1} }

/* Viền + halo gradient nhẹ (màu sync với wallpaper nếu có var --sp-h) */
.ai-glow::before{
  content:""; position:absolute; inset:-12px; border-radius:24px;
  background:
    radial-gradient(120% 120% at 15% 10%, rgba(255,255,255,.06), transparent 60%),
    radial-gradient(140% 140% at 85% 90%, rgba(255,255,255,.05), transparent 60%),
    conic-gradient(from 0deg,
      color-mix(in oklab, oklch(0.85 0.10 var(--sp-h,165)) 30%, transparent),
      transparent 60%,
      color-mix(in oklab, oklch(0.85 0.10 calc((var(--sp-h,165) + 90))) 30%, transparent));
  filter: blur(28px) saturate(120%);
  opacity:.55;
}

/* ZimVer window */
.window.ver{
  position:absolute; left:50%; top:18%; transform:translateX(-50%);
  width:720px; max-width:calc(100vw - 40px);
  height:420px; max-height:calc(100vh - 80px);
  border:1px solid rgba(255,255,255,.18);
  background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
  color:#dfe6ee; border-radius:16px; overflow:hidden;
  backdrop-filter:blur(14px) saturate(140%); -webkit-backdrop-filter:blur(14px) saturate(140%);
  z-index:180;
}
.window.ver .titlebar{
  height:46px; display:flex; align-items:center; justify-content:space-between;
  padding:0 12px; border-bottom:1px solid rgba(255,255,255,.14);
  background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,0));
}
.ver-body{
  padding:14px; height:calc(100% - 46px); overflow:auto; white-space:pre-wrap;
  font:13px/1.5 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
}

/* Glow toàn màn hình khi AI mở */
#aiGlow{
  position:fixed; inset:0; pointer-events:none; z-index:140; display:none;
}
#aiGlow.on{ display:block; animation: aiGlowIn .22s ease-out both; }
@keyframes aiGlowIn{ from{opacity:0} to{opacity:1} }
#aiGlow::before{
  content:""; position:absolute; inset:-14px; border-radius:24px;
  background:
    radial-gradient(120% 120% at 15% 10%, rgba(255,255,255,.06), transparent 60%),
    radial-gradient(140% 140% at 85% 90%, rgba(255,255,255,.05), transparent 60%),
    conic-gradient(from 0deg,
      color-mix(in oklab, oklch(0.85 0.10 var(--sp-h,165)) 30%, transparent),
      transparent 60%,
      color-mix(in oklab, oklch(0.85 0.10 calc((var(--sp-h,165) + 90))) 30%, transparent));
  filter: blur(28px) saturate(120%);
  opacity:.55;
}

/* Window “ZimDex — Version” */
#verWin{
  position:fixed; left:50%; top:18%; transform:translateX(-50%);
  width:720px; max-width:calc(100vw - 40px);
  height:420px; max-height:calc(100vh - 80px);
  z-index:180;
  border:1px solid rgba(255,255,255,.18);
  background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
  color:#dfe6ee; border-radius:16px; overflow:hidden;
  backdrop-filter:blur(14px) saturate(140%); -webkit-backdrop-filter:blur(14px) saturate(140%);
  display:none;
}
#verWin.on{ display:block; }
#verWin .titlebar{
  height:46px; display:flex; align-items:center; justify-content:space-between;
  padding:0 12px; border-bottom:1px solid rgba(255,255,255,.14);
  background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,0));
}
#verBody{
  padding:14px; height:calc(100% - 46px); overflow:auto; white-space:pre-wrap;
  font:13px/1.5 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
}
/* Glow toàn màn hình khi AI mở */
#aiGlow{
  position:fixed; inset:0; pointer-events:none; z-index:140; display:none;
}
#aiGlow.on{ display:block; animation: aiGlowIn .22s ease-out both; }
@keyframes aiGlowIn{ from{opacity:0} to{opacity:1} }
#aiGlow::before{
  content:""; position:absolute; inset:-14px; border-radius:24px;
  background:
    radial-gradient(120% 120% at 15% 10%, rgba(255,255,255,.06), transparent 60%),
    radial-gradient(140% 140% at 85% 90%, rgba(255,255,255,.05), transparent 60%),
    conic-gradient(from 0deg,
      color-mix(in oklab, oklch(0.85 0.10 var(--sp-h,165)) 30%, transparent),
      transparent 60%,
      color-mix(in oklab, oklch(0.85 0.10 calc((var(--sp-h,165) + 90))) 30%, transparent));
  filter: blur(28px) saturate(120%);
  opacity:.55;
}

/* Window “ZimDex — Version” */
#verWin{
  position:fixed; left:50%; top:18%; transform:translateX(-50%);
  width:720px; max-width:calc(100vw - 40px);
  height:420px; max-height:calc(100vh - 80px);
  z-index:180;
  border:1px solid rgba(255,255,255,.18);
  background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
  color:#dfe6ee; border-radius:16px; overflow:hidden;
  backdrop-filter:blur(14px) saturate(140%); -webkit-backdrop-filter:blur(14px) saturate(140%);
  display:none;
}
#verWin.on{ display:block; }
#verWin .titlebar{
  height:46px; display:flex; align-items:center; justify-content:space-between;
  padding:0 12px; border-bottom:1px solid rgba(255,255,255,.14);
  background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,0));
}
#verBody{
  padding:14px; height:calc(100% - 46px); overflow:auto; white-space:pre-wrap;
  font:13px/1.5 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
}

/* ===== Window open/close 3D from dock icon ===== */
.window{
  --fx-x: 0px;           /* delta X từ tâm window -> tâm icon (JS set) */
  --fx-y: 0px;           /* delta Y từ tâm window -> tâm icon (JS set) */
  --fx-persp: 1100px;    /* chiều sâu perspective */
  --fx-tilt: 12deg;      /* độ nghiêng khi đóng/mở */
  --fx-scale-from: .84;  /* scale khi thu nhỏ */
}

/* Open: từ icon -> full window */
@keyframes winOpenFromIcon{
  0%   { transform: perspective(var(--fx-persp)) translate3d(var(--fx-x), var(--fx-y), 0) scale(var(--fx-scale-from)) rotateX(var(--fx-tilt)); opacity:0; }
  70%  { transform: perspective(var(--fx-persp)) translate3d(0,0,0) scale(1.02) rotateX(0); opacity:1; }
  100% { transform: perspective(var(--fx-persp)) translate3d(0,0,0) scale(1) rotateX(0); opacity:1; }
}
/* Close: từ full window -> icon */
@keyframes winCloseToIcon{
  0%   { transform: perspective(var(--fx-persp)) translate3d(0,0,0) scale(1) rotateX(0); opacity:1; }
  100% { transform: perspective(var(--fx-persp)) translate3d(var(--fx-x), var(--fx-y), 0) scale(var(--fx-scale-from)) rotateX(var(--fx-tilt)); opacity:0; }
}

.window.fx-opening{ animation: winOpenFromIcon 340ms cubic-bezier(.2,.85,.15,1) both; }
.window.fx-closing{ animation: winCloseToIcon 240ms cubic-bezier(.2,.85,.15,1) both; }

/* Tôn trọng reduce-motion */
@media (prefers-reduced-motion: reduce){
  .window.fx-opening, .window.fx-closing{ animation: none !important; }
}

/* ===== v2: 3D open/close — tilt mạnh + thu nhỏ đúng kích thước icon ===== */
.window{
  transform-origin: center center;
  --fx-x: 0px;             /* delta X từ tâm win -> tâm icon (JS set) */
  --fx-y: 0px;             /* delta Y từ tâm win -> tâm icon (JS set) */
  --fx-persp: 1200px;      /* chiều sâu */
  --fx-tiltX: 18deg;       /* nghiêng trục X (mặc định nặng hơn) */
  --fx-tiltY: 0deg;        /* nghiêng trục Y (JS set theo hướng icon) */
  --fx-sx: .84;            /* scale X khi thu nhỏ (JS set theo icon) */
  --fx-sy: .84;            /* scale Y khi thu nhỏ (JS set theo icon) */
}

/* Mở: từ icon -> full */
@keyframes winOpenFromIcon{
  0%{
    transform:
      perspective(var(--fx-persp))
      translate3d(var(--fx-x), var(--fx-y), 0)
      rotateX(var(--fx-tiltX)) rotateY(var(--fx-tiltY))
      scale(var(--fx-sx), var(--fx-sy));
    opacity: 0;
  }
  70%{
    transform:
      perspective(var(--fx-persp))
      translate3d(0,0,0)
      rotateX(0) rotateY(0)
      scale(1.02);
    opacity: 1;
  }
  100%{
    transform:
      perspective(var(--fx-persp))
      translate3d(0,0,0)
      rotateX(0) rotateY(0)
      scale(1);
    opacity: 1;
  }
}

/* Đóng: từ full -> icon */
@keyframes winCloseToIcon{
  0%{
    transform:
      perspective(var(--fx-persp))
      translate3d(0,0,0)
      rotateX(0) rotateY(0)
      scale(1);
    opacity: 1;
  }
  100%{
    transform:
      perspective(var(--fx-persp))
      translate3d(var(--fx-x), var(--fx-y), 0)
      rotateX(var(--fx-tiltX)) rotateY(var(--fx-tiltY))
      scale(var(--fx-sx), var(--fx-sy));
    opacity: 0;
  }
}

.window.fx-opening{ animation: winOpenFromIcon 360ms cubic-bezier(.2,.85,.15,1) both; }
.window.fx-closing{ animation: winCloseToIcon 260ms cubic-bezier(.2,.85,.15,1) both; }

@media (prefers-reduced-motion: reduce){
  .window.fx-opening, .window.fx-closing{ animation: none !important; }
}

/* === FX v3 (override) — scale đúng icon + tilt mạnh === */
.window{
  transform-origin: center center;
  --fx-x: 0px; --fx-y: 0px;
  --fx-persp: 1200px;
  --fx-tiltX: 18deg;      /* nghiêng xuống */
  --fx-tiltY: 0deg;       /* JS set tùy hướng */
  --fx-sx: .84; --fx-sy: .84;
}

@keyframes winOpenFromIcon{
  0%{
    transform:
      perspective(var(--fx-persp))
      translate3d(var(--fx-x), var(--fx-y), 0)
      rotateX(var(--fx-tiltX)) rotateY(var(--fx-tiltY))
      scale(var(--fx-sx), var(--fx-sy));
    opacity: 0;
  }
  70%{
    transform:
      perspective(var(--fx-persp))
      translate3d(0,0,0)
      rotateX(0) rotateY(0)
      scale(1.02);
    opacity: 1;
  }
  100%{
    transform:
      perspective(var(--fx-persp))
      translate3d(0,0,0)
      rotateX(0) rotateY(0)
      scale(1);
    opacity: 1;
  }
}

@keyframes winCloseToIcon{
  0%{
    transform:
      perspective(var(--fx-persp))
      translate3d(0,0,0)
      rotateX(0) rotateY(0)
      scale(1);
    opacity: 1;
  }
  100%{
    transform:
      perspective(var(--fx-persp))
      translate3d(var(--fx-x), var(--fx-y), 0)
      rotateX(var(--fx-tiltX)) rotateY(var(--fx-tiltY))
      scale(var(--fx-sx), var(--fx-sy));
    opacity: 0;
  }
}

.window.fx-opening{ animation: winOpenFromIcon 380ms cubic-bezier(.2,.85,.15,1) both; }
.window.fx-closing{ animation: winCloseToIcon 260ms cubic-bezier(.2,.85,.15,1) both; }

@media (prefers-reduced-motion: reduce){
  .window.fx-opening, .window.fx-closing{ animation: none !important; }
}

/* ===== FX v3.2 — heavy tilt + scale đúng icon (override) ===== */
.window{
  transform-origin: center center;
  --fx-x: 0px; --fx-y: 0px;
  --fx-persp: 900px;         /* giảm chiều sâu -> 3D gắt hơn */
  --fx-tiltX: 24deg;         /* nghiêng trục X nặng hơn */
  --fx-tiltY: 0deg;          /* JS set theo hướng icon */
  --fx-sx: .84; --fx-sy: .84;/* JS set theo kích thước icon */
  will-change: transform, opacity;
}

@keyframes winOpenFromIcon{
  0%{
    transform:
      perspective(var(--fx-persp))
      translate3d(var(--fx-x), var(--fx-y), 0)
      rotateX(var(--fx-tiltX)) rotateY(var(--fx-tiltY))
      scale(var(--fx-sx), var(--fx-sy));
    opacity: 0;
  }
  70%{
    transform:
      perspective(var(--fx-persp))
      translate3d(0,0,0)
      rotateX(0) rotateY(0)
      scale(1.04);
    opacity: 1;
  }
  100%{
    transform:
      perspective(var(--fx-persp))
      translate3d(0,0,0)
      rotateX(0) rotateY(0)
      scale(1);
    opacity: 1;
  }
}

@keyframes winCloseToIcon{
  0%{
    transform:
      perspective(var(--fx-persp))
      translate3d(0,0,0)
      rotateX(0) rotateY(0)
      scale(1);
    opacity: 1;
  }
  100%{
    transform:
      perspective(var(--fx-persp))
      translate3d(var(--fx-x), var(--fx-y), 0)
      rotateX(var(--fx-tiltX)) rotateY(var(--fx-tiltY))
      scale(var(--fx-sx), var(--fx-sy));
    opacity: 0;
  }
}

.window.fx-opening{ animation: winOpenFromIcon 420ms cubic-bezier(.2,.85,.15,1) both; }
.window.fx-closing{ animation: winCloseToIcon 300ms cubic-bezier(.2,.85,.15,1) both; }

@media (prefers-reduced-motion: reduce){
  .window.fx-opening, .window.fx-closing{ animation: none !important; }
}

/* ==== FORCE show dock images when has-img (override) ==== */
#logoBtn.has-img #dockLogoImg,
#dockSettings.has-img #dockSettingsImg,
#dockSpotify.has-img #dockSpotifyImg{
  display: block !important;
}
#logoBtn.has-img #dockLogoFallback,
#dockSettings.has-img #dockSettingsFallback,
#dockSpotify.has-img #dockSpotifyFallback{
  display: none !important;
}

/* ===== FX — Tilt-heavy only (no "place down" bounce) ===== */
.window{
  transform-origin: center center;
  --fx-x: 0px; --fx-y: 0px;
  --fx-persp: 900px;
  --fx-tiltX: 26deg;       /* nghiêng nặng trục X */
  --fx-tiltY: 0deg;        /* JS set theo hướng icon */
  --fx-sx: .84; --fx-sy: .84; /* JS set theo kích thước icon */
  will-change: transform, opacity;
}

/* Open: icon -> window (thẳng, không overshoot) */
@keyframes fxOpenTiltOnly{
  0%{
    transform:
      perspective(var(--fx-persp))
      translate3d(var(--fx-x), var(--fx-y), 0)
      rotateX(var(--fx-tiltX)) rotateY(var(--fx-tiltY))
      scale(var(--fx-sx), var(--fx-sy));
    opacity: 0;
  }
  100%{
    transform:
      perspective(var(--fx-persp))
      translate3d(0,0,0)
      rotateX(0) rotateY(0)
      scale(1);
    opacity: 1;
  }
}

/* Close: window -> icon (thẳng, không overshoot) */
@keyframes fxCloseTiltOnly{
  0%{
    transform:
      perspective(var(--fx-persp))
      translate3d(0,0,0)
      rotateX(0) rotateY(0)
      scale(1);
    opacity: 1;
  }
  100%{
    transform:
      perspective(var(--fx-persp))
      translate3d(var(--fx-x), var(--fx-y), 0)
      rotateX(var(--fx-tiltX)) rotateY(var(--fx-tiltY))
      scale(var(--fx-sx), var(--fx-sy));
    opacity: 0;
  }
}

.window.fx-opening{ animation: fxOpenTiltOnly 420ms cubic-bezier(.2,.85,.15,1) both; }
.window.fx-closing{ animation: fxCloseTiltOnly 300ms cubic-bezier(.2,.85,.15,1) both; }

@media (prefers-reduced-motion: reduce){
  .window.fx-opening, .window.fx-closing{ animation: none !important; }
}

#ctxMenu.ctxmenu{ z-index: 99999 !important; pointer-events: auto; }

/* === Right dock icons: force show PNG when has-img === */
#qtWifi.has-img img,
#qtVolume.has-img img,
#qtCam.has-img img,      /* nếu m dùng #qtBattery thì đổi selector này */
#qtBattery.has-img img{
  display: block !important;
  width: 18px; height: 18px; object-fit: contain;
}
#qtWifi.has-img svg,
#qtVolume.has-img svg,
#qtCam.has-img svg,
#qtBattery.has-img svg{
  display: none !important;
}